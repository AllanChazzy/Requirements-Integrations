Sumário

- [Introdução](#introdução)
  - [Roadmap do Integrador](#roadmap-do-integrador)
- [Requisitos da Integração iMendes](#requisitos-da-integração-imendes)
  - [Parâmetros do Sistema](#parâmetros-do-sistema)
  - [Acessos Restritos](#acessos-restritos)
  - [Alterações no Cadastro de Empresas](#alterações-no-cadastro-de-empresas)
  - [Alterações no Cadastro de Produtos](#alterações-no-cadastro-de-produtos)
    - [Funções](#funções)
    - [Novos Campos](#novos-campos)
  - [Métodos de Consulta](#métodos-de-consulta)
  - [Composição da Requisição](#composição-da-requisição)
    - [Detalhamento da Estrutura JSON](#detalhamento-da-estrutura-json)
    - [Exemplo de Requisição API - JSON completo](#exemplo-de-requisição-api---json-completo)
    - [Tratamento do Retorno de Informações](#tratamento-do-retorno-de-informações)
  - [Relação de Campos da Regra Fiscal x Integrador Fiscal](#relação-de-campos-da-regra-fiscal-x-integrador-fiscal)
  - [Consultas em Lotes](#consultas-em-lotes)
    - [Regras de Negócio](#regras-de-negócio)
    - [Simulações de Consulta](#simulações-de-consulta)
- [Requisitos de Homologação](#requisitos-de-homologação)
  - [Checklist do MVP iMendes](#checklist-do-mvp-imendes)
- [Recursos Adicionais](#recursos-adicionais)

---

# Introdução

- O presente documento objetiva descrever em detalhes os processos e meios para Integrações Fiscais de Consulta Tributária do Parceiro **iMendes** no Sistema Ganso.
- No Modelo de Integração definido, o Sistema Ganso comunica-se com o portal tributário do Parceiro Integrador através de uma **API**, e realiza a consulta da Tributação dos produtos obtendo os dados para os mesmos.
- O Integrador Disponibiliza duas **APIs** principais que são: **Saneamento** e **Envia/Recebe Dados**, que respectivamente, retornam a tributação dos Produtos, e lista de produtos do Parceiro.
- A Consulta pode ocorrer em 3 momentos: durante a realização de um **Novo Cadastro**, consultando a tributação de um ou mais **Produtos Cadastrados** ou **Enviando Todos os Produtos** para Revisão Geral. O processo de revisão e classificação tributária denomina-se como **Saneamento** pelo Parceiro.
- A Resposta da Consulta é Imediata em consultas simples ou lotes pequenos, desde que o Produto e Código EAN/GTIN exista na base de dados do Integrador. O **Envio de Todos os Produtos** possui um prazo diferente, e requer até 45 dias para obter o retorno, considerando os que não possuem Código EAN/GTIN, para devolução integral das informações.
- O Integrador recomenda que o Sistema ofereça decisões inviduais ao usuário, ou seja, poderá ou não acatar as alterações tributárias para seus produtos através do próprio Sistema Ganso.
- O Integrador retorna dados suficientes para permitir a criação de Regras Fiscais de Entrada e de Saída completas no Sistema Ganso, entretanto, faz-se necessário o uso de um **Gerenciador Tributário** e uma **Camada de Tratamento de dados** para garantir o direcionamento correto dos dados.

## Roadmap do Integrador

Conforme Análise e Testes da Plataforma do Integrador, foram definidas as seguintes etapas para implementação da integração:

1.  Etapa 1 - Inclusão de Novos Dados no [Cadastro de Empresas](#alterações-no-cadastro-de-empresas) e Inclusão de Novos Parâmetros do Sistema em [Parâmetros do Sistema](#parâmetros-do-sistema)
2.  Etapa 2 - Implementação da Função de Consulta Tributação no [Cadastro de Produtos](#alterações-no-cadastro-de-produtos) e seus Métodos de Consulta descritos em [Métodos de Consulta](#métodos-de-consulta)
3.  Etapa 3 - Implementação da Rotina de Consulta Tributação e Envio/Recebimento de Dados em Lotes na Seção [Consultas em Lotes](#consultas-em-lotes)
4.  Etapa 4 - Validação das Implementações do MVP de acordo com o Checklist do Parceiro descritas em [Checklist MVP](#checklist-do-mvp-imendes)
5.  Etapa 5 - Implementações de Recursos Adicionais do Integrador para atender a Versão Final desejável em [Recursos Adicionais](#recursos-adicionais)

- **Roadmap ilustrado**

  ![Roadmap Integração iMendes](./Roadmap-iMendes.png)

# Requisitos da Integração iMendes

Nesta Seção são descritos os Requisitos a Implementar da Integração iMendes, que atende à Homologação e abrange os principais recursos do Integrador. A princípio, devem ser implementados os **Parâmetros do Sistema**, para permitir a comunicação com o Integrador. Em seguida, Implementar uma função para **Consultar Tributação** através do **Cadastro de Produtos**, considerando 4 (quatro) Métodos de Consulta, que utilizam informações específicas para gerar a Requisição e obter os dados tributários.

## Parâmetros do Sistema

Nesta seção, são descritos os Parâmetros essenciais para o funcionamento desta Integração. Deve ser utilizada a nova aba de **Integrações Fiscais** dos Parâmetros do Sistema, e conter os elementos descritos abaixo:

| Tipo de Elemento          | Posicionamento      | Nome/Texto                                                                 | Descritivo                                                                                                                                                                                                                                    | Validações                                                                                                                                                                                                                                                                                                                |
| :------------------------ | :------------------ | :------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Caixa de Seleção**      | Aba iMendes         | Ativar Integração de Consulta Tributária iMendes                           | Parâmetro Principal para Ativação das Configurações de Integração e funcionalidade no Sistema Ganso                                                                                                                                           | Não permitir ativar se houver outra Integração Fiscal Ativada no Sistema Ganso                                                                                                                                                                                                                                            |
| **Grupo**                 | Aba iMendes         | **Autenticação**                                                           | Organiza os campos de Configurações para conectividade com os Servidores iMendes                                                                                                                                                              | Ativar apenas se o Parâmetro Ativar Integração estiver selecionado                                                                                                                                                                                                                                                        |
| **Campo Texto**           | Grupo Autenticação  | URL da API Saneamento (Consulta Tributação)                                | Campo para informar a URL da API que retorna Dados da Tributação do Produto consultado.                                                                                                                                                       | Permitir até 255 caracteres.                                                                                                                                                                                                                                                                                              |
| **Campo Texto**           | Grupo Autenticação  | URL da API Envia/Recebe Dados (Outros Métodos)                             | Campo para informar a URL da API utilizada para os Recursos Adicionais do iMendes descritos em [Recursos Adicionais iMendes](#recursos-adicionais)                                                                                            | Permitir até 255 caracteres.                                                                                                                                                                                                                                                                                              |
| **Campo Texto Mascarado** | Grupo Autenticação  | Senha                                                                      | Campo para informar a Senha do Cliente Integrado.                                                                                                                                                                                             | Permitir até 30 caracteres alfanuméricos e símbolos                                                                                                                                                                                                                                                                       |
| **Caixa de Combinação**   | Grupo Autenticação  | Versão da API                                                              | Seleção da Versão da API contratada. Disponibilizar as versões 2.0 e 3.0 por padrão                                                                                                                                                           | Permitir selecionar apenas uma das versões                                                                                                                                                                                                                                                                                |
| **Campo de Texto**        | Grupo Autenticação  | Tempo de Resposta                                                          | Timeout ou Tempo de Resposta máximo da API. Tempo máximo que o Sistema deve aguardar para obter a resposta antes de efetuar uma nova requisição.                                                                                              | Campo Numérico, interpretado em segundos, com valor padrão definido em 15 segundos.                                                                                                                                                                                                                                       |
| **Botão de Ação**         | Grupo Autenticação  | Verificar Status                                                           | Botão para acionar um comando de teste de conectividade com as APIs utilizando os dados de Autenticação e URLs informadas.                                                                                                                    | Deve retornar uma Mensagem amigável de Sucesso ou Falha, informando quais APIs foram testadas.                                                                                                                                                                                                                            |
| **Caixa de Combinação**   | Grupo Autenticação  | Ambiente Ativo                                                             | Campo para selecionar o Ambiente de Comunicação Ativado, que pode ser definido entre "**1 - Homologação ou 2 - Produção**". Este código é enviado na Requisição durante uma consulta.                                                         | Permitir selecionar apenas um dos Ambientes.                                                                                                                                                                                                                                                                              |
| **Grupo**                 | Aba iMendes         | **Configurações**                                                          | Organiza os Parâmetros de Regra de Negócio e automatismos da Integração.                                                                                                                                                                      | Ativar apenas se o Parâmetro Ativar Integração estiver selecionado                                                                                                                                                                                                                                                        |
| **Caixa de Seleção**      | Grupo Configurações | Permitir consultar tributação de produtos através do Cadastro de Produtos  | Permite ao Usuário efetuar a Consulta Tributária durante o Cadastramento de um Novo Produto ou de um Produto Cadastrado através de uma ação no próprio Cadastro de Produtos. Se desativar, não exibir o Botão/Função no Cadastro de Produtos. | Observar os Métodos de Consulta ([Ver Seção Métodos de Consulta](#método-de-consulta-básico)) e Acesso Restrito ([Ver Seção Acessos Restritos](#acessos-restritos)) da Operação.                                                                                                                                          |
| **Caixa de Seleção**      | Grupo Configurações | Permitir consultar tributação por descrição do produto                     | Permite ao Usuário consultar a Base do Integrador por Descrição de Produtos e vincular um Produto Cadastrado que não possua Código de Barras Padronizado a um produto semelhante da Lista do Integrador.                                      | Solicitar Acesso Restrito durante o procedimento no Cadastro de Produtos [Ver Seção Acessos Restritos](#acessos-restritos). Se Parâmetro desativado, não considerar o respectivo método de consulta, e informar ao usuário que o cadastro do Produto deverá ter as informações complementadas para viabilizar a consulta. |
| **Campo de Texto**        | Grupo Configurações | Limite de produtos por Lote                                                | Permite definir o Limite Máximo de Produtos a enviar em um Lote por Requisição. Recomendado para atender clientes com limitações de conexão de internet                                                                                       | Limitar ao valor máximo de 1000 e mínimo de 100. Valor Padrão: 100                                                                                                                                                                                                                                                        |
| **Caixa de Seleção**      | Grupo Configurações | Verificar alterações tributárias de produtos automaticamente a cada n dias | Permite ao Sistema Ganso executar uma varredura automática na Base iMendes com finalidade de localizar atualizações de Tributações de Produtos, utilizando método específico da API Envia/Recebe dados.                                       | Informar um número inteiro de dias. Valor padrão: 15 dias                                                                                                                                                                                                                                                                 |

## Acessos Restritos

| Grupo   | Descritivo                                                                                 | Regra de Negócio                                                                                                                                                                                          |
| :------ | :----------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Produto | Consultar a Tributação de um Produto (Consulta Individual) através do Cadastro de Produtos | Restringe um Usuário de efetuar a Consulta Tributária de um Produto e Atualizar seus Tributos se o Parâmetro "Permitir consultar tributação de produtos através do cadastro de produtos" estiver ativado. |
| Produto | Consultar Lista de Produtos do Integrador (Consulta por Descrição)                         | Restringe um Usuário de efetuar uma Consulta na Base do iMendes e vincular um Produto iMendes se o Parâmetro "Permitir consultar tributação por descrição do produto" estiver ativado.                                                  |
| Produto | Restringir Atualização ou Auditoria Tributária do Produto por Integradores Fiscais         | Restringe um Produto de receber Atualizações Tributárias de um Integrador Fiscal ativado ou de ser enviado para Revisão Tributária.                                                                       |

## Alterações no Cadastro de Empresas

O Integrador iMendes requer dados específicos da Empresa que consultará a tributação para compor uma requisição. Deste modo, é necessário criar um **Novo Campo** no Cadastro de Empresas para definir a "Subclassificação do CRT" que indica se a empresa é do **Lucro Real** ou **Lucro Presumido**, conforme descrito abaixo:

| Nome do Campo     | Descritivo                                                                                                                                                                                                                        | Validações                                                                           | Obrigatório |
| :---------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------- | :---------: |
| Regime Tributário | Criar campo para informar a Subclassificação do CRT "3 - Regime Normal", que pode ser definida entre "**Lucro Real - LR**" ou "**Lucro Presumido - LP**". Este dado é obrigatório para enviar uma Requisição à API **Saneamento** | O Campo só pode ser preenchido se o CRT selecionado for igual a "3 - Regime Normal". |   **Sim**   |

## Alterações no Cadastro de Produtos

De modo a viabilizar a consulta breve da tributação de um produto, é necessário criar uma **Função** no Cadastro de Produtos que permita tal operação, além de **Novos Campos** para gerenciamento e auditoria, conforme abaixo:

### Funções

| Nome da Função       | Descritivo                                 | Regras de Negócio                                                                                                                                                                                                                      |
| :------------------- | :----------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Consultar Tributação | Aciona a Consulta Tributária ao Integrador | Ativar Função somente se o Parâmetro "Permitir consultar tributação de produtos através do Cadastro de Produtos". Solicitar Acesso Restrito para a Operação. [Ver Seção Acessos Restritos](#acessos-restritos) se Parâmetro habilitado. |

### Novos Campos

| Tipo                 | Posicionamento                     | Nome/Texto                             | Descritivo                                                                                                                                                                                                                                                                                | Regras de Negócio                                                                                                                                                                                |
| :------------------- | :--------------------------------- | :------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Campo**            | **Grupo de Dados do Produto**      | Código iMendes                         | Criar campo para armazenar e exibir o Código do Produto da Base do Integrador. Este Código é obtido quando ocorrer o vínculo durante a Consulta por Descrição efetuada pelo Usuário.                                                                                                      | Tipo Numérico Inteiro e Somente Leitura                                                                                                                                                          |
| **Campo**            | **Grupo de Tributação/Fiscal**     | Status da Integração Fiscal            | Criar campo para armazenar e exibir a Situação do Produto enviado para **Revisão Tributária**. Deve funcionar como uma espécie de "Log" da Revisão do Produto.                                                                                                                            | Criar Siglas específicas para representar a real situação como, por exemplo, **"NR - Não Revisado", "PR - Pendente de Revisão", "R - Revisado"**. Campo Somente leitura e visualmente destacado. |
| **Campo**            | **Grupo de Tributação/Fiscal**     | Auditado por iMendes                   | Criar campo para exibir a informação de que o Produto teve a tributação auditada/atualizada pelo Integrador Fiscal. Exibir a Data/Hora da última atualização tributária, p.ex.: "Auditado por iMendes em 29/11/2022 - 07:43".                                                             | Somente leitura e visualmente destacado.                                                                                                                                                         |
| **Caixa de Seleção** | **Grupo de Parâmetros do Produto** | **Não Tributar por Integrador Fiscal** | Parâmetro para restringir a atualização de Tributos do Produto pelo Integrador Fiscal. Por decisão do Usuário ou por orientação da Contabilidade, alguns produtos podem ser tributados seguindo a sua própria interpretação e não deverão receber atualizações tributárias do Integrador. | Solicitar Acesso Restrito. [Ver Seção Acessos Restritos](#acessos-restritos).                                                                                                                    |

## Métodos de Consulta

Os Métodos de Consulta são necessários para a tomada de decisão durante a consulta tributária de um Produto, pois, _depende de quais informações serão fornecidas pelo Usuário ao Sistema_. Cada Método trata um _input_ e possui uma API de consulta específica, que requer dados específicos. A seguir a definição de cada Método:

|    Método    |                   Tipo de Consulta                   | Descritivo                                                                                                                                                                                                        |     API a Consumir     | Tags de Envio Principais                                                                               | Regras de Negócio                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| :----------: | :--------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------: | :----------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Método 1** | **Código de Barras EAN/GTIN e Descrição do Produto** | Consultar a Tributação do Produto utilizando o Código de Barras EAN/GTIN e a Descrição do Produto.                                                                                                                |     **Saneamento**     | `"codigo":"EAN", "codInterno":"N", "codIMendes":"", "descricao":"DESCRICAO"`, `"perfil"/"origem": "0"` | Identificar se o Código é um EAN válido, considerando tamanho de 8, 12, 13 ou 14 dígitos. Durante envio da Consulta, considerar sempre 14 dígitos para envio, preenchendo com Zeros à esquerda caso EAN diferente de tamanho 14. Se EAN válido, identificar se o Prefixo do Código de Barras inicia em "789" ou "790", ou "1789" ou "1790" e enviar origem igual a 0, caso contrário enviar origem igual a 8. Capturar o retorno dos dados pela Tag `"prodEAN"`. |
| **Método 2** |                 **Apenas Descrição**                 | Consultar a Tributação de um Produto utilizando a Descrição. Método disponível em outro Endpoint, que retorna uma lista de Produtos semelhantes, e permite vincular um Produto da Lista com o Produto Cadastrado. | **Envia/Recebe Dados** | `"nomeservico":"DESCPRODUTOS", "dados":"CNPJ\|DESCRICAO" `                                             | Permitir vincular apenas **um** Produto iMendes com **um** Produto Cadastrado. Solicitar Acesso Restrito para esta operação. Permitir vincular o Produto com/sem Código de Barras Padronizado que não está vinculado a um Código iMendes. [Ver Seção Acessos Restritos](#acessos-restritos)                                                                                                                                                                      |
| **Método 3** |            **Código iMendes e Descrição**            | Consultar a Tributação do Produto utilizando o Código iMendes previamente vinculado ao Produto Cadastrado.                                                                                                        |     **Saneamento**     | `"codIMendes":"CODIGOVINCULADO", "descricao":"DESCRICAO"`                                              | Verificar se o Produto possui um Código iMendes, se sim, utilizar esta informação para localizar a tributação.                                                                                                                                                                                                                                                                                                                                                   |
| **Método 4** |                  **Código Interno**                  | Consultar a Tributação do Produto utilizando o **Código Interno** do Produto Ganso previamente classificado pela iMendes. Este Método requer que a Base de Produtos tenha sido enviada anteriormente à iMendes.   |     **Saneamento**     | `"codInterno":"CODIGOINTERNO"`                                                                         | Verificar se o Produto possui o campo **Enviado para Integrador Fiscal** preenchido para definir utilização deste método. [Ver definição do Campo no Cadastro de Produto](#cadastro-de-produtos)                                                                                                                                                                                                                                                                 |

Para ilustrar a tomada de decisão que o Sistema Ganso deverá realizar conforme o _Input de dados_ do Usuário ou Dados coletados do Produto, o **Fluxo de Decisão** abaixo define a direção a ser tomada.

![Fluxo de Decisão do Método de Consulta](./Flow-Decision-Method-02.png)

[Voltar ao Sumário](#introdução) | [Voltar ao Roadmap](#roadmap)

## Composição da Requisição

Inicialmente foram descritos os Métodos de Consulta que o Parceiro oferece, e nesta seção, é descrito como deve ser realizada uma Requisição à API do Integrador.
Conforme **Manual de Integração iMendes**, uma Consulta ao **Parceiro** requer um padrão `JSON`. Supondo que o Sistema Ganso possua os Métodos implementados, a Consulta Simples (Apenas um Produto) através do **Cadastro de Produtos** pode ser compreendida através dos seguintes passos:

1. Usuário aciona a **Função de Consulta** criada na Documentação de Integrações Fiscais Geral.
2. O Sistema identifica **quais dados foram inseridos pelo Usuário** através do **Fluxo de Decisão de Método de Consulta** para definir o [**Método de Consulta**](#métodos-de-consulta) ideal e coleta as informações que compõem as _Tags_ principais para efetuar consulta utilizando a API correta.
3. Se o **Método de Consulta** identificado for igual a **"Método 2 - Apenas Descrição"**, continuar a partir do **Passo 8**, senão, continuar a partir do **Passo 4**.
4. O Sistema Coleta dados do Emitente (Dados da Empresa) e gera a _Tag_ `"emit"` do `JSON`.
5. O Sistema Coleta dados do Perfil do Destinatário da Operação, que nesta situação, trata-se de um Perfil **Consumidor Final** e gera a _Tag_ `"perfil"` do `JSON`.
6. O Sistema Coleta dados do Produto e gera a _Tag_ `"produtos"`.
7. O Sistema Constrói a estrutura `JSON` obedecendo a hierarquia estabelecida: `emit` > `perfil` > `produtos` e executa o **Passo 9**
8. Utilizar a **API Envia/Recebe Dados** e exibir a **Nova Tela de Consulta por Descrição** para Usuário decidir qual produto do iMendes vincular ao Produto Cadastrado. A partir deste ponto, o Produto possuirá um Código iMendes, e portanto, utilizará o Método de Consulta 3. O Sistema deve continuar do **Passo 2**.
9. O Sistema envia requisição à API indicada no Método identificado. [Ver Seção Parâmetros](#parâmetros-imendes)
10. O Sistema obtém retorno de dados tributários e os envia à **Camada de Tratamento** que determinará a Criação ou Atualização das Regras Fiscais correspondentes à Operação.

O Fluxo abaixo exemplifica as Estratégias de Envio de Requisição:

![Fluxo de Estratégia de Envio de Requisição](./Flow-Strategies-Send-Request.png)

### Detalhamento da Estrutura JSON

A Tag `emit` que deve conter os dados da **Empresa**, possui a seguinte relacionamento de dados abaixo:

| Dado                | Tag                 | Tipo      | Descritivo                                                                                                                                                                                                                   | Origem dos Dados                                                               | Preenchimento Obrigatório |
| :------------------ | :------------------ | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------- | :-----------------------: |
| Ambiente            | `"amb"`             | Código    | Tipo de Ambiente de Envio da Requisição, sendo 1 = Homologação e 2 = Produção.                                                                                                                                               | Consultar o Parâmetro "Ambiente Ativo" em [Parâmetros](#parâmetros-do-sistema) |          **Sim**          |
| CNPJ                | `"cnpj"`            | Caractere | CNPJ do Emitente da Consulta (Cliente)                                                                                                                                                                                       | **Cadastro de Empresas** campo "CNPJ"                                          |          **Sim**          |
| CRT                 | `"crt"`             | Código    | Código do CRT da Empresa. 1 = Simples Nacional, 2 = Simples Nacional com excesso de sublimite ou 3 = Regime Normal                                                                                                           | **Cadastro de Empresas** campo "CRT"                                           |          **Sim**          |
| Regime Tributário   | `"regimeTrib"`      | Caractere | Regime Tributário da Empresa. Novo Campo Regime Tributário do Cadastro de Empresas. Se "Lucro Real" definir 'LR', se "Lucro Presumido" definir 'LP'                                                                          | **Cadastro de Empresas** campo novo "Regime Tributário".                       |          **Sim**          |
| UF                  | `"uf"`              | Caractere | UF do Emitente                                                                                                                                                                                                               | **Cadastro de Empresas** campo "UF" do Endereço                                |          **Sim**          |
| CNAE                | `"cnae"`            | Caractere | CNAE do Emitente                                                                                                                                                                                                             | **Cadastro de Empresas** campo "CNAE"                                          |          **Não**          |
| Substuto Tributário | `"substICMS"`       | Caractere | Indicativo de Emitente Substituto Tributário. Se houver uma Inscrição Estadual de Substituto Tributário informada no Cadastro de Empresas, deve ser enviada esta informação tanto na tag `"emit"` quando na Tag `"produtos"` | **Cadastro de Empresas** grid de dados "Inscrição Substituto Tributário"       |          **Não**          |
| Dia                 | `"Dia"`             | Número    | Dia da Vigência combinada com Mês e Ano para consultas específicas por Data                                                                                                                                                  | Não necessário                                                                 |          **Não**          |
| Mês                 | `"Mês"`             | Número    | Mês da Vigência combinada com Dia e Ano para consultas específicas por Data                                                                                                                                                  | Não necessário                                                                 |          **Não**          |
| Ano                 | `"Ano"`             | Número    | Ano da Vigência combinada com Dia e Mês para consultas específicas por Data                                                                                                                                                  | Não necessário                                                                 |          **Não**          |
| Interdependente     | `"interdependente"` | Caractere | Informação específica. Enviar sempre como "N"                                                                                                                                                                                | Não necessário                                                                 |          **Sim**          |

A Tag `perfil` compõe o **Perfil do Destinatário da Operação** em que se deseja obter a Tributação. Deste modo, através de **Consulta Básica** via **Cadastro de Produtos**, a operação específica de **Saída na Operação de Venda ao Consumidor Final (NFC-e)** deve ser fixada. Para as demais operações estes dados também serão necessários, contudo serão tratados de maneira distinta de acordo com as Operações desejadas pelo Usuário, e devem ser realizadas Consultas através da **Nova Tela - Gerenciador Tributário**.

| Dado                      | Tag            | Tipo                          | Descritivo                                                                                                                                                                                                                                                  | Regra de Negócio                                                                                                                                                                                                                                                                                                                     | Preenchimento Obrigatório |
| :------------------------ | :------------- | :---------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----------------------: |
| UF                        | `"uf"`         | **Lista de Dados**            | Lista de UFs para Consulta de Regras.                                                                                                                                                                                                                       | Se a consulta ocorrer através do Cadastro de Produtos, utilizar a UF da Empresa Filial Logada, senão, utilizar as UFs informadas no campo do Gerenciador Tributário.                                                                                                                                                                 |          **Sim**          |
| CFOP                      | `"cfop"`       | **Código da Operação**        | Código da Operação a ser Realizada. Deve ser enviada uma operação coerente com os dados desejados, por exemplo, uma Operação de Venda deve conter um CFOP que indique operação de Venda, mesmo que este não seja o correto (a iMendes retornará o correto). | Se a consulta ocorrer através do Cadastro de Produtos, preencher com o Código **"5102"**, senão, preencher com o CFOP Padrão da Finalidade de Operação informada no Gerenciador Tributário.                                                                                                                                          |          **Sim**          |
| Característica Tributária | `"caracTrib"`  | **Lista de Códigos Inteiros** | Indica o **Tipo de Destinatário** da Operação. Esta informação deve ser obtida do Cadastro de Perfil Fiscal, do campo "Característica Tributária".                                                                                                          | Deve retornar um Código para cada Característica definida no Perfil Fiscal: <br>0 - Industrial <br>1 - Distribuidor <br>2 - Atacadista <br>3 - Varejista <br>4 - Produtor Rural Pessoa Jurídica <br>6 - Produtor Rural Pessoa Física <br>7 - Pessoa Jurídica não Contribuinte do ICMS <br>8 - Pessoa Física não Contribuinte do ICMS |          **Sim**          |
| Finalidade                | `"finalidade"` | Código                        | Indica a Destinação do Produto para a Operação informada. É importante para especificar a operação, e deve ser obtida do campo **"Finalidade do Produto"** do Cadastro da **Finalidade de Operação** informada para Consulta.                               | Valores possíveis: 0 - Mercadoria para Revenda <br>1 - Insumos de Produção <br>2 - Materiais para Uso e Consumo ou Ativo Imobilizado.                                                                                                                                                                                                |          **Sim**          |
| Simples Nacional          | `"simplesN"`   | Caractere                     | Indica se o Destinatário da Operação é Simples Nacional ou Não. Preencher com "S" ou "N", conforme Regra de Negócio.                                                                                                                                        | Se CRT da Empresa Filial Logada é igual a 1 ou 2, enviar "S", senão, enviar "N".                                                                                                                                                                                                                                                     |          **Sim**          |
| Origem                    | `"origem"`     | Código                        | Indica a Origem da Mercadoria.                                                                                                                                                                                                                              | Se Tipo de Consulta igual a **Método 1**, e **Código de Barras** não iniciar em 789 ou 790, enviar Código 8.                                                                                                                                                                                                                         |          **Sim**          |
| Substituição Tributária   | `"substICMS"`  | Caractere                     | Indica se o destinatário é Substituto Tributário.                                                                                                                                                                                                           | Se houver uma Inscrição Estadual de Substituto Tributário informada no Cadastro de Empresas, deve ser enviado "S", caso contrário enviar "N"                                                                                                                                                                                         |          **Sim**          |

Obtidos os dados do Perfil, a Tag de `"produtos"` é um _array_ de Produtos e deve ser composta conforme dados e Regras de Negócio abaixo:

| Dado           | Tag            | Tipo      | Descritivo                                                                                                                               | Origem dos Dados                                                                                            | Regras de Negócio                                                                                                                                                                                                                            | Preenchimento Obrigatório |
| :------------- | :------------- | :-------- | :--------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-----------------------: |
| Código         | `"codigo"`     | Código    | Código de Barras EAN/GTIN ou Código Interno do Produto quando o mesmo foi enviado previamente para Saneamento pela iMendes.              | **Cadastro de Produtos** campo Código de Barras Padrão ou Código Interno                                    | Verificar o Método de Consulta apropriado para preenchimento deste campo, observando a Regra de Negócio. [Ver Seção Métodos de Consulta](#métodos-de-consulta)                                                                               |          **Sim**          |
| Código Interno | `"codInterno"` | Caractere | Indicativo de "Sim" ou "Não" para consulta via Código Interno, quando o Produto foi enviado previamente para Saneamento pela iMendes     | Preencher com "S" ou "N" de acordo com a Regra de Negócio                                                   | Se o Produto está sinalizado como **"Enviado para Integrador Fiscal"**, enviar "S" e utilizar o **Método de Consulta 4** informando Código Interno do Produto na Tag `codigo` do JSON. [Ver Seção Métodos de Consulta](#métodos-de-consulta) |          **Sim**          |
| Descrição      | `"descricao"`  | Caractere | Descrição Completa do Produto                                                                                                            | **Cadastro de Produtos** campo "Descrição"                                                                  | Sempre enviar a Descrição Completa do Produto.                                                                                                                                                                                               |          **Sim**          |
| Código iMendes | `"codImendes"` | Código    | Código _Único_ fornecido pela iMendes. Quando um produto é vinculado ao código iMendes esta informação deve ser utilizada para consulta. | **Cadastro de Produtos** campo **"Codigo iMendes"** [Ver Seção Cadastro de Produtos](#cadastro-de-produtos) | Verificar se o Código iMendes está preenchido, se sim, enviar este Código, senão enviar em branco. Utilizar o **Método de Consulta 3** [Ver Seção Métodos de Consulta](#métodos-de-consulta)                                                 |          **Não**          |
| NCM            | `"ncm"`        | Caractere | Nomenclatura Comum do Mercosul                                                                                                           | **Cadastro de Produtos** campo "NCM"                                                                        | Verificar se NCM está preenchido no Cadastro do Produto. Esta informação é importante para a correta classificação do produto.                                                                                                               |          **Não**          |

### Exemplo de Requisição API - JSON completo

A Estrutura abaixo exemplifica uma Consulta do Produto **Água Mineral** através do **Cadastro de Produtos** para **Operação de Saída por Venda a Consumidor Final** para o Estado de **MS** (Operação Interna). Na Tag `perfil/uf` é enviada apenas a UF correspondente à UF da Empresa Filial, ou seja, da Tag `emit/uf`. Para Requisições contendo a UF da Empresa Filial e outras UF, o Sistema deverá dividir em 2 requisições: uma contendo apenas a UF da Empresa Filial e outra contendo as demais UFs com diferença no primeiro dígito do CFOP que deve indicar a operação interestadual.

```JSON
{
  "emit": {
    "amb": 1,
    "cnpj": "04391715000173",
    "crt": 3,
    "regimeTrib": "LR",
    "uf": "MS",
    "cnae": "",
    "substICMS": "N",
    "interdependente": "N"
  },
  "perfil": {
    "uf": ["MS"],
    "cfop": "5102",
    "caracTrib": [8],
    "finalidade": 0,
    "simplesN": "N",
    "origem": "0",
    "substICMS": "N"
  },
  "produtos": [
    {
      "codigo": "7894900531008",
      "codInterno": "N",
      "codIMendes": "",
      "descricao": "AGUA MINERAL CRYSTAL C/GAS 500ML",
      "ncm": "22011000"
    }
  ]
}
```

### Tratamento do Retorno de Informações

Utilizando como exemplo a Requisição descrita anteriormente, os dados retornados possuirá a seguinte Estrutura de Dados `JSON`:

```JSON
 { "Cabecalho": {
        "sugestao": "Se a comunicação estiver lenta, reduza o número de UF's, Caract. Tributárias e produtos. Nessa ordem.",
        "amb": 1,
        "cnpj": "04391715000173",
        "dthr": "2022-08-18T11:37:34.7495236-03:00",
        "transacao": "48773646",
        "mensagem": "OK",
        "prodEnv": 1,
        "prodRet": 1,
        "prodNaoRet": 0,
        "comportamentosParceiro": "104;106;108",
        "comportamentosCliente": "",
        "versao": "2.3.5.0"
    },
    "Grupos": [
        {
            "codigo": "7408",
            "nCM": "22011000",
            "cEST": "03.005.04",
            "lista": "",
            "tipo": "",
            "codAnp": "",
            "passivelPMC": "S",
            "impostoImportacao": 20.00,
            "pisCofins": {
                "cstEnt": "73",
                "cstSai": "06",
                "aliqPis": 0.00,
                "aliqCofins": 0.00,
                "nri": "918",
                "ampLegal": "'Lei n 13.097/2015, Art. 28'",
                "redPis": 0,
                "redCofins": 0
            },
            "iPI": {
                "cstEnt": "03",
                "cstSai": "53",
                "aliqipi": 0.00,
                "codenq": "999",
                "ex": "00"
            },
            "Regras": [
                {
                    "uFs": [
                        {
                            "uF": "MS",
                            "CFOP": {
                                "cFOP": "5102",
                                "CaracTrib": [
                                    {
                                        "codigo": "8",
                                        "finalidade": "0",
                                        "codRegra": "1473",
                                        "codExcecao": 0,
                                        "cFOP": "5405",
                                        "cST": "60",
                                        "cSOSN": "",
                                        "aliqIcmsInterna": 17.00,
                                        "aliqIcmsInterestadual": 0.00,
                                        "reducaoBcIcms": 0.00,
                                        "reducaoBcIcmsSt": 0,
                                        "redBcICMsInterestadual": 0,
                                        "aliqIcmsSt": 0,
                                        "iVA": 0,
                                        "iVAAjust": 0,
                                        "fCP": 0.00,
                                        "codBenef": "",
                                        "pDifer": 0,
                                        "pIsencao": 0.00,
                                        "antecipado": "N",
                                        "desonerado": "N",
                                        "isento": "N",
                                        "tpCalcDifal": 0,
                                        "ampLegal": "'BASE LEGAL DA SUBSTITUICAO TRIBUTARIA - RICMS/MS, ANEXO III, SUBANEXO I, TABELAS IV-A E IV-B, ITEM 5.4'",
                                        "InfPDV": {
                                            "pICMSPDV": 0,
                                            "simbPDV": "F",
                                            "cstICMS": "60",
                                            "csosn": "",
                                            "cstSai": "06",
                                            "aliqPis": 0.00,
                                            "aliqCofins": 0.00
                                        },
                                        "Protocolo": {},
                                        "Convenio": {}
                                    }
                                ]
                            },
                            "mensagem": "OK"
                        }
                    ]
                }
            ],
            "prodEan": [
                "07894900531008"
            ],
            "Mensagem": "OK"
        }
    ],
    "SemRetorno": []
}
```

A _Tag_ `"Cabecalho"` contém as informações sobre a Requisição enviada e os dados devem ser interpretados para orientar o Usuário durante os processos de consulta. Abaixo, a relação de informações e sua utilidade:

| Tag                        | Descritivo                                                           | Utilidade                                              |
| :------------------------- | :------------------------------------------------------------------- | :----------------------------------------------------- |
| `"sugestao"`               | Mensagens da API                                                     | Apenas informativo                                     |
| `"amb"`                    | Ambiente Habilitado: 1 - Homologação / 2 - Produção                  | Validação do Parâmetro "Ambiente Ativo"                |
| `"cnpj"`                   | CNPJ do Cliente Integrado                                            | Validação Cadastral                                    |
| `"dthr"`                   | Data e Hora do Retorno dos dados                                     | Gravação de Logs de Consulta ou Retorno da API         |
| `"transacao"`              | Código da Transação gerada na API do Integrador                      | Auxiliar a solução de problemas                        |
| `"mensagem"`               | Mensagens da API                                                     | Apenas informativo                                     |
| `"prodEnv"`                | Produtos Enviados na Requisição                                      | Validação ou Verificação de Dados enviados             |
| `"prodRet"`                | Produtos Retornados pela Requisição                                  | Validação ou Verificação de Dados recebidos e enviados |
| `"comportamentosParceiro"` | Comportamentos configurados pelo Integrador para o Parceiro (Ganso)  | Apenas Informativo                                     |
| `"comportamentosCliente"`  | Comportamentos configurados pelo Integrador para o Cliente Integrado | Apenas Informativo                                     |
| `"versao"`                 | Versão da API utilizada para Consulta/Retorno                        | Apenas Informativo                                     |

É de suma importância gravar estes dados em Log para eventual solução de problemas. O Integrador sugere a criação de um relatório de fácil acesso para estas situações.

A _Tag_ `"Grupos"` é um conjunto de dados (_Array_) que contém as informações tributárias sobre os Produtos retornados, organizados por código de grupo Tributário, NCM e demais informações tributárias coincidentes. Para cada **Grupo**, haverão Regras para cada **UF, Operação e Característica Tributária** consultada. Os dados serão aninhados hierarquicamente e obedecendo uma sequencia.
Abaixo o descritivo das informações mais importantes do grupo, considerando a ordem de cima para baixo do exemplo anterior:

| Tag                      | Descritivo                                                                                                                                |   Tag Pai   | Observações                                                                                                                                                                                                    |
| :----------------------- | :---------------------------------------------------------------------------------------------------------------------------------------- | :---------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Grupos`                 | Tag principal que organiza os dados tributários chave, o detalhamento da tributação e os produtos que utilizam a tributação do Grupo      |      -      | Array de dados                                                                                                                                                                                                 |
| `codigo`                 | Código do Grupo Tributário correspondente aos dados da Requisição                                                                         |  `Grupos`   | Pode ser considerado um Código de Agrupamento de Regras                                                                                                                                                        |
| `nCM`                    | NCM do Produto (Nomenclatura Comum do Mercosul)                                                                                           |  `Grupos`   | NCM correto para utilizar nos Produtos relativos ao Grupo.                                                                                                                                                     |
| `cEST`                   | CEST do Produto (Código Especificador da Substituição Tributária)                                                                         |  `Grupos`   | CEST correto para utilizar nos Produtos relativos ao Grupo.                                                                                                                                                    |
| `codAnp`                 | Código da ANP do Produto (Produto específico igual a Combustível)                                                                         |  `Grupos`   | Código da ANP correto a ser utilizado em Produtos Específicos                                                                                                                                                  |
| `impostoImportacao`      | Alíquota de Imposto de Importação aplicável ao Produto                                                                                    |  `Grupos`   | Informação utilizada apenas no DF-e de Saída. Ainda não definida em Regra Fiscal                                                                                                                               |
| `pisCofins`              | Grupo de Informações do PIS e Cofins                                                                                                      |  `Grupos`   | Dados aplicáveis a todos os Produtos do Grupo                                                                                                                                                                  |
| `cstEnt`                 | CST de PIS e de COFINS de Entrada                                                                                                         | `pisCofins` | CST aplicável às operações de Entrada do Produto. PIS e COFINS são impostos gêmeos, portanto o CST de PIS e COFINS de Entrada devem ser iguais.                                                                |
| `cstSai`                 | CST de PIS e de COFINS de Saída                                                                                                           | `pisCofins` | CST aplicável às operações de Saída do Produto. PIS e COFINS são impostos gêmeos, portanto o CST de PIS e COFINS de Saída devem ser iguais.                                                                    |
| `aliqPis`                | Alíquota de PIS                                                                                                                           | `pisCofins` | Alíquota aplicável ao Produto. Se a _Tag_ `infPDV` existir no retorno, considerar esta Alíquota como Entrada, caso contrário, considerar para Entrada e Saída                                                  |
| `aliqCofins`             | Alíquota de Cofins                                                                                                                        | `pisCofins` | Alíquota aplicável ao Produto. Se a _Tag_ `infPDV` existir no retorno, considerar esta Alíquota como Entrada, caso contrário, considerar para Entrada e Saída                                                  |
| `nri`                    | Natureza da Receita                                                                                                                       | `pisCofins` | CST da Natureza da Receita para PIS e COFINS. Código único de identificação de Natureza do Produto                                                                                                             |
| `ampLegal`               | Amparo Legal do PIS e COFINS                                                                                                              | `pisCofins` | Informações sobre a Base Legal (da esfera Federal) para a Tributação do PIS e COFINS                                                                                                                           |
| `iPI`                    | Grupo de Informações do IPI                                                                                                               |  `Grupos`   | Dados Aplicáveis a todos os Produtos do Grupo                                                                                                                                                                  |
| `cstEnt`                 | CST de IPI de Entrada                                                                                                                     |    `iPI`    | CST do IPI de Entrada aplicável às operações de Entrada do Produto                                                                                                                                             |
| `cstSai`                 | CST de IPI de Saída                                                                                                                       |    `iPI`    | CST do IPI de Saída aplicável às operações de Saída do Produto                                                                                                                                                 |
| `aliqipi`                | Alíquota de IPI                                                                                                                           |    `iPI`    | Alíquota de IPI aplicável à operação                                                                                                                                                                           |
| `codenq`                 | Código de Enquadramento do IPI                                                                                                            |    `iPI`    | Código de Enquadramento segundo a TIPI.                                                                                                                                                                        |
| `ex`                     | Código de Exceção/Exclusão da TIPI                                                                                                        |    `iPI`    | Código de Excessão/Exclusão segundo a TIPI.                                                                                                                                                                    |
| `Regras`                 | Grupo de Informações das Regras                                                                                                           |  `Grupos`   | Detalhamento das Regras Fiscais para os Produtos retornados                                                                                                                                                    |
| `uFs`                    | Grupo de Informações Tributárias por UF (Lista de UFs)                                                                                    |  `Regras`   | Agrupamento das informações tributárias por UF da Lista de UFs informadas na Requisição                                                                                                                        |
| `uF`                     | Identificação de uma das UFs informadas na Requisição                                                                                     |    `UFs`    | Identificação da UF correspondente aos dados aplicáveis correspondentes à UF informada na Requisição                                                                                                           |
| `CFOP`                   | Grupo de Informações Tributárias por CFOP (Lista de CFOPs)                                                                                |    `UFs`    | Agrupamento das informações tributárias por CFOP da Lista de CFOPs informados na Requisição                                                                                                                    |
| `cFOP`                   | Identificação do Código CFOP informado na Requisição                                                                                      |   `CFOP`    | Identificação do CFOP correspondente aos dados aplicáveis correspondentes aos CFOPs informado na Requisição                                                                                                    |
| `CaracTrib`              | Grupo de Informações Tributárias aplicáveis ao CFOP e UF retornados nos níveis acima                                                      |   `CFOP`    | Agrupamento das informações tributárias aplicáveis correspondentes à UF e CFOP informados na Requisição                                                                                                        |
| `codigo`                 | Código da Característica Tributária informada na Requisição. Ver [Tag Perfil/Campo Característica Tributária](#composição-da-requisição). | `CaracTrib` | Código da Característica Tributária informada na Requisição                                                                                                                                                    |
| `finalidade`             | Código da Finalidade do Produto informada na Requisição. Ver [Tag Perfil/Campo Finalidade do Produto](#composição-da-requisição).         | `CaracTrib` | Código da Finalidade do Produto informada na Requisição                                                                                                                                                        |
| `codRegra`               | Código da Regra Fiscal da Base do Integrador relativo ao Grupo de Tributação.                                                             | `CaracTrib` | Código da Regra Fiscal do Integrador. Gravar este Código no campo "Código Integrador" da Regra Fiscal do Sistema Ganso                                                                                         |
| `cFOP`                   | Código do CFOP aplicável à operação                                                                                                       | `CaracTrib` | Código do CFOP aplicável à operação consultada, ou seja, o CFOP efetivo da operação.                                                                                                                           |
| `cST`                    | CST do ICMS aplicável à operação                                                                                                          | `CaracTrib` | CST do ICMS aplicável à operação. Se a _Tag_ `infPDV` existir no retorno, considerar o campo `cstICMS`. Concatenar o Código enviado no campo `origem`da _Tag_ `perfil` para completar os 3 dígitos necessários |
| `cSOSN`                  | CSOSN do ICMS aplicável à operação                                                                                                        | `CaracTrib` | CSOSN do ICMS aplicável à operação. Se a _Tag_ `infPDV` existir no retorno, considerar o campo `csosn`. Concatenar o Código enviado no campo `origem`da _Tag_ `perfil` para completar os 4 dígitos necessários |
| `aliqIcmsInterna`        | Alíquota Interna do ICMS aplicável à operação                                                                                             | `CaracTrib` | Alíquota Interna do ICMS aplicável à operação. Se a _Tag_ `infPDV` existir no retorno, considerar o campo `pICMSPDV` e `simbPDV` para utilizar o tributo correto.                                              |
| `aliqIcmsInterestadual`  | Alíquota Interestadual do ICMS aplicável à operação                                                                                       | `CaracTrib` | Alíquota Interestadual do ICMS aplicável à operação. Se a _Tag_ `infPDV` existir no retorno, considerar o campo `pICMSPDV` e `simbPDV` para utilizar o tributo correto.                                        |
| `reducaoBcIcms`          | Percentual de Redução de Base de Cálculo do ICMS Normal aplicável à operação                                                              | `CaracTrib` | Percentual de Redução de Base de Cálculo aplicável ao ICMS Normal para Operações Internas                                                                                                                      |
| `reducaoBcIcmsSt`        | Percentual de Redução de Base de Cálculo do ICMS ST aplicável à operação                                                                  | `CaracTrib` | Percentual de Redução de Base de Cálculo aplicável ao ICMS ST                                                                                                                                                  |
| `redBcICMsInterestadual` | Percentual de Redução de Base de Cálculo do ICMS Normal aplicável à operação                                                              | `CaracTrib` | Percentual de Redução de Base de Cálculo aplicável ao ICMS Normal para Operações Interestaduais                                                                                                                |
| `aliqIcmsSt`             | Alíquota do ICMS ST aplicável à operação                                                                                                  | `CaracTrib` | Alíquota de ICMS ST aplicável                                                                                                                                                                                  |
| `iVA`                    | Percentual de Margem de Valor Agregado aplicável à Operação Interna                                                                       | `CaracTrib` | MVA% Aplicável à operação interna                                                                                                                                                                              |
| `iVAAjust`               | Percentual de Margem de Valor Agregado aplicável à Operação Interestadual                                                                 | `CaracTrib` | MVA% Aplicável à operação interestadual conforme alíquota interestadual                                                                                                                                        |
| `fCP`                    | Percentual de Fundo de Combate à Pobreza aplicável à operação                                                                             | `CaracTrib` | Percentual de FCP aplicável ao ICMS Normal e ao ICMS ST                                                                                                                                                        |
| `codBenef`               | Código do Benefício Fiscal da Operação                                                                                                    | `CaracTrib` | Informação do Produto                                                                                                                                                                                          |
| `pDifer`                 | Percentual de Diferimento do ICMS da Operação                                                                                             | `CaracTrib` | Diferimento Aplicável ao Valor do ICMS                                                                                                                                                                         |
| `pIsencao`               | Percentual de Desoneração do ICMS da Operação                                                                                             | `CaracTrib` | Desoneração Aplicável. Se campo `desonerado` igual a 'S' utilizar o percentual para cálculo da Desoneração. Caso contrário, ignorar.                                                                           |
| `ampLegal`               | Amparo Legal do ICMS                                                                                                                      | `CaracTrib` | Informações sobre a Base Legal (da esfera Estadual) para a Tributação do ICMS                                                                                                                                  |

Após Processo de Envio e Captura de Retorno, os seguintes passos devem ocorrer:

1. A **Camada de Tratamento** deve interpretar e relacionar os dados com respectivos destinos, conforme descrito nas tabelas de [**Relação de Campos da Regra Fiscal x Integrador Fiscal**](#relação-de-campos-da-regra-fiscal-x-integrador-fiscal).
2. Efetivar a gravação dos dados na Regra Fiscal correspondente, e efetivar a gravação de [**Logs**](#logs).

[Voltar ao Sumário](#introdução) | [Voltar ao Roadmap](#roadmap-do-integrador)

## Relação de Campos da Regra Fiscal x Integrador Fiscal

Os Integradores Fiscais possuem dados para alimentar a Regra Fiscal de Entrada e Saída do Sistema Ganso. A Tabela a seguir aponta quais campos obrigatórios da **Regra Fiscal Ganso** devem ser alimentados pelo Retorno da **Consulta Avançada** para cada Integrador.

| Campo do Ganso                  | Tabela              | Descritivo                                                 |             Retorno iMendes              | Regra de Negócio                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :------------------------------ | :------------------ | :--------------------------------------------------------- | :--------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| descricao                       | produto_prf         | Descrição da Regra Fiscal                                  |                    -                     | Criar uma descrição padronizada utilizando dados das informações tributárias de retorno. Sugestão: "RF IMENDES - [Tipo Entrada ou Saída] NCM [NCM] - [Perfil Fiscal] - [UF]"                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| codigo_filial                   | produto_prf         | Código da Filial de Consulta                               |                    -                     | Preencher com o Código da Filial que realizou a Consulta                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| data_inicial                    | produto_prf         | Data de Vigência Inicial                                   |                    -                     | Preencher com a Data Atual da Criação da Regra                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| data_final                      | produto_prf         | Data de Vigência Final                                     |                    -                     | Deixar em branco                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| status                          | produto_prf         | Status da Regra                                            |                    -                     | Marcar como "Ativa"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| tipo_operacao                   | produto_prf         | Tipo de Regra Fiscal (Entrada ou Saída)                    |      Depende da Operação Consultada      | Preencher com 'E' ou 'S' conforme disponibilidade de dados do Integrador                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| orig_finalidoperacao            | produto_prf         | Código da Finalidade da Operação (Critério)                |      Depende da Operação Consultada      | Preencher com o Código da **Finalidade do Produto** relacionado à Finalidade de Operação cadastrada que foi enviada para Consulta à API.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| orig_perfil_fiscal              | produto_prf         | Código do Perfil Fiscal (Critério)                         |   Depende do Perfil Fiscal Consultado    | Preencher com o Código da Característica Tributária relacionada ao **Perfil Fiscal** enviado para consulta à API.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| orig_uf                         | produto_prf         | UFs de Origem (Critério)                                   |   Depende da UF da Operação Consultada   | Preencher com as UFs retornadas na Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ncm                             | produto_prf         | NCM do Produto (Critério)                                  |               `Grupos/nCM`               | Preencher com o NCM retornado na Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| cest                            | produto_prf         | CEST do Produto (Critério)                                 |              `Grupos/cEST`               | Preencher com o CEST retornado na Tag correspondente. Eliminar a máscara do retorno deste campo.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| orig_cfop                       | produto_prf         | CFOP de Origem (Critério)                                  |             `CaracTrib/cFOP`             | Preencher com o CFOP retornado na Tag correspondente ou utilizar o CFOP Padrão da Operação configurado na Finalidade de Operação.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| orig_cst                        | produto_prf         | CST/CSOSN de Origem                                        |             `CaracTrib/cST`              | Preencher com o CST ou CSOSN retornado pela Tag correspondente. Se Integrador retornar apenas 2 dígitos, complementar o primeiro dígito com o dígito '0' ou conforme **Documentação do Integrador**                                                                                                                                                                                                                                                                                                                                                                                                                   |
| sugere_cfop_sn                  | produto_prf         | Definir o CFOP                                             |                    -                     | Preencher com 'S' para que o campo de CFOP seja preenchido com a informação retornada da Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| sugere_cfop                     | produto_prf         | CFOP a aplicar                                             |             `CaracTrib/cFOP`             | Preencher com o CFOP retornado pela Tag correspondente do Integrador, quando existir. **Consultar Documentação do Integrador**. <br> Quando não existir informação, utilizar o CFOP padrão da operação informado no Cadastro de Finalidade de Operação.                                                                                                                                                                                                                                                                                                                                                               |
| sugere_icms_cstcsosn_sn         | produto_prf         | Definir CST/CSOSN                                          |                    -                     | Preencher com 'S' para que o CST/CSOSN seja preenchido com a informação retornada da Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| sugere_icms_cstcsosn            | produto_prf         | CST/CSOSN a aplicar                                        |   `CaracTrib/cST` ou `CaracTrib/cSOSN`   | Preencher com o CST ou CSOSN retornado pela Tag correspondente do Integrador, adicionando como prefixo o dígito '0' ou conforme **Documentação do Integrador**                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| zerar_icms                      | produto_prf         | Zerar ICMS do Produto                                      |                    -                     | Se `CaracTrib/cST` = '60' e `CaracTrib/cFOP` = 'x403' ou 'x405' definir como 'S', caso contrário, definir como 'N'. **Consultar Documentação do Integrador**                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| sugere_icms_aliq_sn             | produto_prf         | Definir Alíquota Efetiva do ICMS (Alíquota Final)          |                    -                     | Preencher com 'S' se `CaracTrib/cST` diferente de '60' e `CaracTrib/cFOP` diferente de 'x403' ou 'x405'. **Consultar Documentação do Integrador**                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **sugere_icms_aliq_interna_sn** | produto_prf         | (Campo novo) Definir Alíquota Interna do ICMS              |                    -                     | Preencher com 'S' se `CaracTrib/cST` diferente de '60' e `CaracTrib/cFOP` diferente de 'x403' ou 'x405'. **Consultar Documentação do Integrador**                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| codigo_produto_tributo          | produto_prf         | Código do Tributo da Alíquota Efetiva do ICMS a Aplicar    |            `infPDV/pICMSPDV`             | **Regra 1** - Se UF igual a UF da Empresa Filial e o campo `CaracTrib/cST` igual a '60', preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" seja igual a 'F'. <br><br>**Regra 2** - Se UF igual a UF da Empresa Filial, `CaracTrib/cST` diferente de '60', e campo `CaracTrib/aliqIcmsInterna` maior que "zero", preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" igual a 'T' e campo "CST" seja igual ao campo `CaracTrib/aliqIcmsInterna`.                                                                                        |
| sugere_icms_aliq                | produto_prf         | Alíquota Efetiva de ICMS (Alíquota Final) a Aplicar        |            `infPDV/pICMSPDV`             | **Regra 1** - Se UF igual a UF da Empresa Filial e o campo `CaracTrib/cST` igual a '60', preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" seja igual a 'F'. <br><br>**Regra 2** - Se UF igual a UF da Empresa Filial, `CaracTrib/cST` diferente de '60', e campo `CaracTrib/aliqIcmsInterna` maior que "zero", preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" igual a 'T' e campo "CST" seja igual ao campo `CaracTrib/aliqIcmsInterna`.                                                                                        |
| **sugere_icms_aliq_interna**    | produto_prf         | (Campo novo) Alíquota de ICMS Interna a Aplicar            |       `CaracTrib/aliqIcmsInterna`        | **Regra 1** - Se UF igual a UF da Empresa Filial e o campo `CaracTrib/cST` igual a '60', preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" seja igual a 'F'. <br><br>**Regra 2** - Se UF igual a UF da Empresa Filial, `CaracTrib/cST` diferente de '60', e campo `CaracTrib/aliqIcmsInterna` maior que "zero", preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" igual a 'T' e campo "CST" seja igual ao campo `CaracTrib/aliqIcmsInterna`.                                                                                        |
| sugere_icms_rbc_sn              | produto_prf         | Definir Redução de Base de Cálculo do ICMS                 |                    -                     | Preencher com 'S' para que o campo Redução de Base seja preenchido                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| sugere_icms_rbc                 | produto_prf         | Percentual da Redução de Base de Cálculo do ICMS a Aplicar |        `CaracTrib/reducaoBcIcms`         | Preencher com a informação do campo retornado conforme Saída ou Entrada.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| sugere_icms_pdiferimento_sn     | produto_prf         | Definir Diferimento                                        |                    -                     | Preencher com 'S' se o campo retornado for maior que zero.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| sugere_icms_pdiferimento        | produto_prf         | Percentual de Diferimento do ICMS                          |            `CaracTrib/pDifer`            | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **sugere_icms_pdesoneracao_sn** | produto_prf         | (Campo novo) Definir Desoneração do ICMS                   |                    -                     | Preencher com 'S' se o campo `CaracTrib/pIsencao` for maior que zero.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **sugere_icms_pdesoneracao**    | produto_prf         | (Campo novo) Percentual de Desoneração do ICMS             |           `CaracTrib/pIsencao`           | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_fcp_aliq_sn              | produto_prf         | Definir FCP ICMS                                           |                    -                     | Preencher com 'S' se o campo retornado for maior que zero.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| sugere_fcp_aliq                 | produto_prf         | Percentual de FCP ICMS                                     |             `CaracTrib/fCP`              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| icmsst_lancamento               | produto_prf         | Lançamento do ICMS ST (alterado para Destaque)             |                    -                     | **Regra 1** - Se `CaracTrib/cST` = '60' e `CaracTrib/cFOP` = '1403' ou '1401', e UF igual a UF da Empresa Filial, definir como 'O' (Original). <br><br> **Regra 2** - Se `CaracTrib/cST` = '10' e `CaracTrib/cFOP` = '2401' ou '2403', `CaracTrib/aliqIcmsInterestadual` diferente de zero, e UF diferente da UF da Empresa Filial, definir como 'D' (Dentro da NF). <br><br>**Regra 3** - Se `CaracTrib/cST` = '60' e `CaracTrib/cFOP` = '2403', `CaracTrib/aliqIcmsInterestadual` diferente de zero, `CaracTrib/iVAAjust` diferente de zero, e UF diferente da UF da Empresa Filial, definir como 'F' (Fora da NF). |
| mod_bc_icms_st                  | produto_prf         | Modalidade da Base de Cálculo do ICMS ST                   |                    -                     | Se icmsst_lancamento igual a 'D' ou 'F', preencher este campo com o código 4.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| sugere_icmsst_rbc_sn            | produto_prf         | Definir Redução de Base de Cálculo do ICMS ST              |                    -                     | Se campo retornado maior que zero, preencher este campo com 'S', caso contrário, definir como 'N'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| sugere_icmsst_rbc               | produto_prf         | Percentual de Redução de Base de Cálculo do ICMS ST        |       `CaracTrib/reducaoBcIcmsSt`        | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| icms_st_aliq                    | produto_prf         | Alíquota de ICMS ST                                        |          `CaracTrib/aliqIcmsSt`          | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_icmsst_fcp_aliq_sn       | produto_prf         | Definir Percentual de FCP ICMS ST                          |                    -                     | Se `CaracTrib/fCP` maior que zero, preencher este campo com 'S'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| sugere_icmsst_fcp_aliq          | produto_prf         | Percentual de FCP ICMS ST                                  |             `CaracTrib/fCP`              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| origem_aliquota_icms            | **produto_prf_mva** | Alíquota de Origem do MVA                                  |    `CaracTrib/aliqIcmsInterestadual`     | Preencher com a informação do campo retornado apenas se maior que Zero, e se o campo **icmsst_lancamento** for definido como 'D' ou 'F'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| mva                             | **produto_prf_mva** | MVA - Margem de Valor Agregado Ajustada                    |           `CaracTrib/iVAAjust`           | Preencher com a informação do campo retornado apenas se o maior que Zero, e se o campo **icmsst_lancamento** for definido como 'D' ou 'F'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **mva_saida**                   | produto_prf         | (Campo Novo) MVA - Margem de Valor Agregado de Saída       |             `CaracTrib/iVA`              | Preencher com a informação do campo retornado apenas se o maior que Zero, e se o campo **icmsst_lancamento** for definido como 'D' ou 'F'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| sugere_ipi_cst_sn               | produto_prf         | Definir CST de IPI                                         |                    -                     | Definir como 'S' para que o campo do CST seja preenchido                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| sugere_ipi_cst                  | produto_prf         | CST de IPI de Entrada                                      |           `Grupos/iPI/cstEnt`            | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_ipi_aliq_sn              | produto_prf         | Definir Alíquota de IPI                                    |                    -                     | Definir como 'S' para que o campo da alíquota seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_ipi_aliq                 | produto_prf         | Alíquota de IPI de Entrada                                 |           `Grupos/iPI/aliqipi`           | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_pis_cst_sn               | produto_prf         | Definir CST de PIS                                         |                    -                     | Definir como 'S' para que o campo do CST seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| sugere_pis_cst                  | produto_prf         | CST de PIS a Aplicar                                       | `pisCofins/cstEnt` ou `pisCofins/cstSai` | Preencher com a informação do campo retornado conforme tipo de Regra Fiscal (Entrada ou Saída)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_pis_aliq_sn              | produto_prf         | Definir Alíquota de PIS                                    |                    -                     | Definir como 'S' para que o campo do CST seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| sugere_pis_aliq                 | produto_prf         | Alíquota de PIS a aplicar                                  |           `pisCofins/aliqPis`            | Preencher com a informação do campo retornado conforme tipo de Regra Fiscal (Entrada ou Saída)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_cofins_cst_sn            | produto_prf         | Definir CST de Cofins                                      |                    -                     | Definir como 'S' para que o campo do CST seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| sugere_cofins_cst               | produto_prf         | CST de Cofins a Aplicar                                    | `pisCofins/cstEnt` ou `pisCofins/cstSai` | Preencher com a informação do campo retornado conforme tipo de Regra Fiscal (Entrada ou Saída)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_cofins_aliq_sn           | produto_prf         | Definir Alíquota de Cofins                                 |                    -                     | Definir como 'S' para que o campo do CST seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| sugere_cofins_aliq              | produto_prf         | Alíquota de Cofins a Aplicar                               |          `pisCofins/aliqCofins`          | Preencher com a informação do campo retornado conforme tipo de Regra Fiscal (Entrada ou Saída)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_piscofins_natrec_sn      | produto_prf         | Definir Natureza da Receita de PIS e Cofins                |                    -                     | Definir como 'S' para que o campo do CST seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| sugere_piscofins_natrec_sn      | produto_prf         | Código da Natureza da Receita de PIS e Cofins              |             `pisCofins/nri`              | Verificar se Código já existe na tabela NATUREZA_RECEITA, se não existir, deve ser criado um Registro com este novo Código, e Descrição genérica como "Natureza criada pelo integrador" e preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                              |

[Voltar ao Sumário](#introdução) | [Voltar ao Roadmap](#roadmap)

## Consultas em Lotes

A Consulta em Lotes ao Integrador iMendes utilizará a **Nova Tela de Gerenciador Tributário**, e inicialmente, algumas **Regras de Negócio** devem ser observadas para tomada de decisão com base na ação tomada pelo Usuário:

### Regras de Negócio

| Ação do Usuário                                                                                                                             | Regra de Negócio                                                                                                                                        | Resposta ao Usuário                                                                                                                                                                                                                                                                                                                 | Dados para Composição da Requisição                                                                                                                                                                                 | Tags de Envio Principais                                        |
| :------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------------------------------------------------------- |
| Informar uma **Finalidade de Operação** do tipo **Entrada** ou **Saída** e no campo UFs informar a UF da Empresa Filial Logada e outras UFs | Gerar uma **Requisição** específica para a UF da Empresa Filial e uma **Requisição** específica para as demais UFs.                                     | O Sistema deve informar ao usuário que serão geradas Requisições distintas para API, e que os dados Recebidos serão agrupados por UF informada para melhor compreensão.                                                                                                                                                             | Utilizar o **Código CFOP Padrão** da **Finalidade de Operação** informada para gerar a **Requisição**. Utilizar a **Finalidade do Produto** contida na **Finalidade da Operação** informada para compor a Consulta. | `perfil/uf`, `perfil/cfop`, `perfil/finalidade`                 |
| Filtrar e Selecionar Produtos que requerem **Métodos de Consulta** distintos. [**Ver Seção Métodos de Consulta**](#métodos-de-consulta)     | Tratar cada situação de modo distinto (conforme o Método de Consulta) para assegurar que a consulta seja realizada utilizando a API correta da iMendes. | O Sistema deve informar ao Usuário que determinados Produtos poderão ser consultados por meios distintos e que alguns deverão ser processados individualmente, como por exemplo, Produtos que precisam ser **Consultados na Base iMendes por Descrição**. [Ver na Seção Métodos de Consulta os Métodos 2 e 3](#métodos-de-consulta) | Código iMendes, campo "Enviado para Integrador Fiscal" do Cadastro de Produtos                                                                                                                                      | `produtos/codigo`, `produtos/codInterno`, `produtos/codImendes` |

[Voltar ao Sumário](#introdução) | [Voltar ao Roadmap](#roadmap)

### Simulações de Consulta

# Requisitos de Homologação

Nesta seção contém a relação de recursos que o Sistema Ganso deve oferecer para que a Homologação seja concluída com sucesso.

## Checklist do MVP iMendes

| Item  | Requisito iMendes                                                                                                                                                                                                          | Requisito Ganso                                                                                | Grau de Importância | Implementado |
| :---: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------- | :-----------------: | :----------: |
| MVP 1 | Opção para Usuário definir que o Produto Cadastrado não deve ser enviado à iMendes                                                                                                                                         | Documentação de Requisitos de Integrações / Cadastro de Produtos                               |      **Alto**       |      -       |
| MVP 2 | Opção para Usuário enviar informações manualmente                                                                                                                                                                          | [Ver Seção Consulta em Lotes](#consultas-em-lotes)                                             |      **Alto**       |      -       |
| MVP 3 | Captura de Retorno controlado por Log e **Reversão** de tributação atualizada de qualquer Produto em qualquer ponto do histórico                                                                                           | Documentação de Requisitos de Integrações / Requisitos de Segurança                            |      **Alto**       |      -       |
| MVP 4 | Consultar a Tributação de um único produto através do Cadastro do Produto e receber as atualizações após consulta                                                                                                          | Documentação de Requisitos de Integrações / Cadastro de Produtos                               |      **Alto**       |      -       |
| VF 1  | Opção para Usuário vincular um Produto próprio com o Código iMendes                                                                                                                                                        | [Ver Seção Métodos de Consulta - Método 2](#métodos-de-consulta)                               |      **Alto**       |      -       |
| VF 2  | Gravar e exibir no Cadastro do Produto um selo indicativo de auditoria da tributação pela IMendes                                                                                                                          | Documentação de Requisitos de Integrações / Cadastro de Produtos                               |      **Alto**       |      -       |
| VF 3  | Gravar e exibir o Retorno da Consulta por Produto contendo todos os campos retornados pela API e permitir a seleção de campos individuais para atualização. Apresentar a relação **Antes e Depois** e um Aceite do Usuário | -                                                                                              |      **Alto**       |      -       |
| VF 4  | Efetuar verificação períodica de Atualizações Tributárias dos Produtos auditados por iMendes através do Método **Alterados**                                                                                               | [Ver Seção Parâmetros do Sistema](#parâmetros-do-sistema), parâmetro **Verificação Periódica** |      **Alto**       |      -       |
| VF 5  | Criar um Relatório Gerencial para acompanhamento do Histórico de Mudanças Tributárias ocorridas em determinado período                                                                                                     | [Documentação de Requisitos de Integrações / Requisitos de Segurança                           |      **Alto**       |      -       |
| VF 6  | Implementar o **Simulador Tributário** que efetua uma verificação no Cadastro de Produtos e aponta os problemas tributários em Clientes ainda não integrados                                                               | -                                                                                              |      **Médio**      |      -       |
| VF 7  | Implementar mensagem de **Sugestão de Contratação da iMendes** para captura de novos clientes                                                                                                                              | -                                                                                              |      **Baixo**      |      -       |

**Legenda**: Coluna **Item**: MVP - Implementação Mínima | VF - Versão Final (Recursos Adicionais)

# Recursos Adicionais
