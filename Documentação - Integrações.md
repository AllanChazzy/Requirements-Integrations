# Documentação de Requisitos - Integrações Fiscais

---

- [Documentação de Requisitos - Integrações Fiscais](#documentação-de-requisitos---integrações-fiscais)
- [Introdução](#introdução)
- [Roadmap](#roadmap)
- [Requisitos](#requisitos)
  - [Cadastro de Empresas](#cadastro-de-empresas)
  - [Parâmetros do Sistema - Autenticação e Regras de Negócio](#parâmetros-do-sistema---autenticação-e-regras-de-negócio)
  - [Cadastro de Finalidade de Operações](#cadastro-de-finalidade-de-operações)
  - [Cadastro de Perfil Fiscal](#cadastro-de-perfil-fiscal)
  - [Cadastro de Produtos](#cadastro-de-produtos)
    - [Funções](#funções)
    - [Novos Campos](#novos-campos)
  - [Regra Fiscal Ganso](#regra-fiscal-ganso)
  - [Nova Tela - Gerenciador Tributário](#nova-tela---gerenciador-tributário)
  - [Nova Tela - Comparativo de Tributos (Antes x Depois)](#nova-tela---comparativo-de-tributos-antes-x-depois)
  - [Nova Tela - Consulta por Descrição de Produto](#nova-tela---consulta-por-descrição-de-produto)
- [Relação de Campos Ganso x Integrador Fiscal](#relação-de-campos-ganso-x-integrador-fiscal)
  - [Tabela Produto](#tabela-produto)
  - [Tabela Produto Parâmetros](#tabela-produto-parâmetros)
  - [Campos Dependentes](#campos-dependentes)
  - [Regra Fiscal x Integrador Fiscal](#regra-fiscal-x-integrador-fiscal)
- [Requisitos da Regra Fiscal de Saída Ganso](#requisitos-da-regra-fiscal-de-saída-ganso)
- [Requisitos de Segurança](#requisitos-de-segurança)
  - [Acessos Restritos](#acessos-restritos)
  - [Logs](#logs)

---

# Introdução

- O presente documento objetiva descrever em detalhes a Estrutura Necessária para Integrações Fiscais de Consulta Tributária de qualquer parceiro no Sistema Ganso.
- No Modelo de Integração adotado, o Sistema Ganso comunica-se com o portal tributário do Parceiro Integrador através de uma **API**, e realiza a consulta da Tributação dos produtos, e obtém dados para a **Formação de Base de Dados de Regras Fiscais** que serão consumidas pelas Rotinas do Sistema Ganso.

# Roadmap

O **Roadmap** é um guia que indicará o caminho em uma ordem lógica para a implementação dos Recursos Necessários descritos neste documento. Cada Integrador Fiscal possui uma _rota_ específica que deve ser obedecida para que os objetivos sejam atingidos, entretanto, os **Recursos Globais** devem ser implementados antes de cada Integrador Esepecífico. Abaixo o diagrama.

![Roadmap Completo](./Roadmap-Global0.png)

# Requisitos

Nesta Seção, são descritos os **Requisitos Globais** obrigatórios e comuns a todas as Integrações desta documentação. Conforme definido no [Roadmap](#recursos-globais) é necessário adequar determinadas rotinas do Sistema Ganso para permitir integração fiscal, que requer modificações em Cadastros e Inclusão de Recursos específicos.

## Cadastro de Empresas

Determinados Integradores requerem informações específicas da Empresa que são utilizadas durante uma requisição à API, deste modo, novos campos são necessários e estão relacionados abaixo:

| Nome              | Descritivo                                                                                                                                                                                                              | Validações                                                                                                                                                                                          | Obrigatório |
| :---------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------: |
| Regime Tributário | Campo para informar a Subclassificação do CRT "Regime Normal", cuja informação pode ser definida entre "**Lucro Real - LR**" ou "**Lucro Presumido - LP**". Este dado é obrigatório para a obtenção de Regras corretas. | Deve ser permitido informá-lo apenas se o CRT selecionado for igual a "3 - Regime Normal".                                                                                                          |   **Sim**   |
| Área da Loja      | Campo para informar o tamanho da área fisica ocupada pelo estabelecimento do cliente em Metros Quadrados                                                                                                                | Informação importante para o Integrador Mix Fiscal, que oferece para o Cliente Integrado insights de organização mercadológica de espaços, proximidade de produtos e composição de mix de produtos. |   **Não**   |

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Parâmetros do Sistema - Autenticação e Regras de Negócio

- Para organizar os Integradores Fiscais de modo claro e objetivo, em **Parâmetros Gerais do Sistema** criar uma Aba "**Integrações Fiscais**" que deve conter uma "**Sub-aba**" para cada Integrador contendo as respectivas configurações individuais.

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Cadastro de Finalidade de Operações

Alguns Integradores requerem que uma **Operação** seja bem definida durante a composição de uma Consulta Tributária, e estas possuem dados específicos de envio para que o Retorno de dados tributários sejam coerentes com o **Cenário** informado.

- A **iMendes** requer que um Código **CFOP** seja enviado (correto ou não, mas válido e coerente com a operação de Entrada ou Saída desejada) para consultar Regras para a operação e demais características informadas. Mesmo que o CFOP não seja o correto, é necessário haver um Código padrão de envio para obter o correto da operação.
- A **Mix Fiscal** requer que um **Cenário** Tributário pré-definido seja informado para consultar Regras e retornar os respectivos dados.

Deste modo, os novos campos necessários neste Cadastro são:
| Tipo de Elemento | Posicionamento | Nome/Texto | Descritivo | Regras de Negócio | Integrador |
|:---|:---|:---|:---|:---|:---:|
| **Botão de Seleção** | Grupo de Dados da Finalidade | Tipo de Movimentação | Seleção para indicar se a Finalidade de Operação cadastrada é uma Movimentação do Tipo **Entrada** ou **Saída**. Utilizado em conjunto com os demais campos para complementar dados da Requisição. Esta informação também será utilizada para composição de Regras Fiscais de Entrada ou Saída | Preenchimento Obrigatório. | **Todos** |
| **Caixa de Combinação** | Grupo de Dados da Finalidade | Operação | Seleção para indicar a Espécie de Operação com base nas Movimentações existentes no Sistema, como por exemplo, as Movimentações existentes na Tela de Documentos Fiscais (Venda, Devolução de Venda, Devolução de Compra, Remessa de Entrega Futura, Saída para Consumo...) | Preenchimento Obrigatório. <br> Deve conter por padrão todas as "Operações" padronizadas possíveis que são: <br><br> - Entrada de Mercadorias <br> - Venda a Consumidor Final <br> - Venda a Contribuinte <br> - Acompanhamento de Cupom Fiscal <br> - Devolução de Compra <br> - Devolução de Venda <br> - Transferência de Estoque <br> - Saída para Consumo <br> - Saída para Produção <br> - Saída por Perda <br> - Remessa de Entrega Futura <br> - Reclassificação de Mercadorias | **Todos**
| **Grupo de Dados** | Tela | Cenário Fiscal | Grupo para organizar dados específicos do Cenário Fiscal da Finalidade de Operação. | Preenchimento Obrigatório. | **Todos** |
| **Campo** | Cenário Fiscal | CFOP Padrão Estadual | Campo para informar o Código do CFOP padrão para a Operação Estadual Cadastrada. Utilizado em conjunto com os demais campos para complementar dados da requisição a API do Integrador, e para complementar dados da Regra Fiscal. | Preenchimento Obrigatório. Validar se o CFOP existe na Tabela de CFOPs do Sistema Ganso conforme a definição do Tipo de Movimentação de **Entrada** ou **Saída**, e se o primeiro dígito é compatível com o Tipo de Movimentação: 1 para **Entrada** e 5 para **Saída**. | **Todos** |
| **Campo** | Cenário Fiscal | CFOP Padrão Interestadual | Campo para informar o Código do CFOP padrão para a Operação Interestadual Cadastrada. Utilizado em conjunto com os demais campos para complementar dados da requisição à API do Integrador. | Preenchimento Obrigatório. Validar se o CFOP existe na Tabela de CFOPs do Sistema Ganso conforme a definição do Tipo de Movimentação de **Entrada** ou **Saída**, e se o primeiro dígito é compatível com o Tipo de Movimentação: 2 para **Entrada** e 6 para **Saída**. | **Todos** |
| **Caixa de Combinação** | Cenário Fiscal | Finalidade do Produto | Campo para definir a Finalidade do Produto. Alguns Integradores podem requerer este dado que se refere à finalidade do produto (destinação) para retornar a regra correta. Deve existir por padrão as seguintes opções:<br> 0 = Mercadoria para Revenda <br> 1 = Insumos de Produção <br> 2 = Materiais para Uso e Consumo ou Ativo Imobilizado | Preenchimento obrigatório. Deve retornar o Código relacionado à opção definida. | **Todos** |
| **Caixa de Combinação** | Cenário Fiscal | Origem | Caixa de Combinação para definir a "Origem da Operação". Esta informação é exigida por alguns Integradores para criação de um _Cenário Fiscal_ na API. | Preenchimento Obrigatório quando o Integrador ativado é igual a **Mix Fiscal**. Deve existir por padrão as seguintes opções: <br> EI - Entrada Indústria <br> ED - Entrada Distribuidor <br> ES - Entrada Simples Nacional <br> BO - Bonificação <br> TR - Transferência. <br> A sigla referente à opção definida é utilizada na Criação de um Cenário Fiscal na API. | **Todos** |
| **Caixa de Combinação** | Cenário Fiscal | Destino | Campo para definir o Parâmetro "Destino da Operação". Esta informação é exigida por alguns Integradores para criação de um _Cenário Fiscal_ na API. | Preenchimento Obrigatório quando o Integrador ativado é igual a **Mix Fiscal**. A sigla referente à opção definida é utilizada na Requisição à API. Deve existir por padrão as seguintes opções: <br> SAC - Saída Atacado Contribuinte <br> SAS - Saída Atacado Simples Nacional <br> SVC - Saída Varejo Contribuinte <br> SNC - Saída Não Contribuinte <br> IND - Industrialização <br> TRA - Transferência | **Todos** |
| **Caixa de Combinação** | Cenário Fiscal | UF Destino | Campo para definir a UF de destino da Operação. Esta informação é exigida para criação de um _Cenário Fiscal_ na API. Trata-se da UF da **Operação** que influencia diretamente nas informações tributárias que serão retornadas pela API. | Permitir selecionar apenas uma UF da lista para o Cenário. | **Todos** |
| **Campo de Texto** | Cenário Fiscal | Código Integrador | Campo para gravar e exibir o _hash_ do _Cenário Fiscal_ cadastrado na API do Integrador quando o recurso for exigido. Obrigatório existir quando o Integrador ativado é igual a **Mix Fiscal** | Somente leitura. | **Todos** |
| **Texto** | Grupo de Dados da Finalidade | Criado em DD/MM/AAAA - HH:MM - Usuário | Texto para exibir a Data/Hora e Usuário que efetuou o Cadastro. | Somente Leitura. | **Todos** |
| **Texto** | Grupo de Dados da Finalidade | Modificado em DD/MM/AAAA - HH:MM - Usuário | Texto para exibir a Data/Hora e Usuário de modificação do Cadastro do Cenário Fiscal. | Somente Leitura. | **Todos** |
| **Botão** | Cenário Fiscal | Atualizar Cenário | Botão de ação para Atualizar o Cenário Fiscal cadastrado na API do Integrador, quando o recurso existir. | Deve existir um "Código Integrador" vinculado à finalidade cadastrada para que seja possível atualizar o Cenário na API do Integrador, quando o recurso existir. Usuário deve possuir permissão. [Ver Seção Acessos Restritos](#acessos-restritos) | **Todos** |
| **Botão** | Cenário Fiscal | Criar Cenário Integrador | Botão de ação para Criar um novo Cenário Fiscal com base nas informações inseridas no Cadastro de Finalidade. | O Usuário deve possuir permissão para executar a função. [Ver Seção Acessos Restritos](#acessos-restritos) | **Todos** |

O _Wireframe_ abaixo ilustra os elementos descritos acima para o Cadastro de Finalidade de Operação.

![Wireframe - Cadastro de Finalidade de Operação](./Wireframe-Cadastro-Finalidade.png)

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Cadastro de Perfil Fiscal

Além de uma Operação bem definida, o Integrador **iMendes** requer que seja enviada na requisição uma **Característica Tributária** (Código específico) que no Sistema Ganso é definido como **Perfil Fiscal**. Atualmente, este cadastro é aberto e definido pelo usuário, e não garante que um Código de Característica coerente seja enviado. Desde modo, é necessário criar um campo que contenha esta informação pré-definida que também poderá ser utilizada por outros Integradores Fiscais.

| Tipo de Elemento        | Nome/Texto                | Descritivo                                                                                                                                                                                                                                         | Regras de Negócio                                                                                                                                                                                                                                                                                                                                              | Integrador |
| :---------------------- | :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------: |
| **Caixa de Combinação** | Regime Tributário         | Campo para informar o Regime Tributário vinculado ao Perfil Fiscal. Esta informação é importante para composição de Regras Fiscais e criação de Cenários Fiscais. Disponibilizar as opções **"Lucro Real", "Lucro Presumido", "Simples Nacional"** | Preenchimento Obrigatório                                                                                                                                                                                                                                                                                                                                      | **Todos**  |
| **Caixa de Combinação** | Característica Tributária | Campo para informar a característica tributária (tipo de perfil) vinculada ao Perfil Fiscal criado. O Perfil Fiscal poderá ter uma descrição livre, contudo, deve ser vinculado à característica padronizada que é utilizada na Requisição.        | Preenchimento obrigatório se o Integrador **iMendes** estiver ativado. <br> Deve existir as seguintes opções: <br> - Industrial <br> - Distribuidor <br> - Atacadista <br> - Varejista <br> - Produtor Rural Pessoa Jurídica <br> - Produtor Rural Pessoa Física <br> - Pessoa Jurídica não Contribuinte do ICMS <br> - Pessoa Física não Contribuinte do ICMS | **Todos**  |

Estas informações são necessárias para a Atualização/Criação de Regras Fiscais de Entrada e Saída automaticamente conforme Resultado das Consultas aos Integradores Fiscais.

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Cadastro de Produtos

Para disponibilizar ao Usuário o Método de Consulta de Tributos através do Cadastro de um Produto (e quando o Integrador contemplar tal recurso), é necessário incluir **Funções Específicas** e **Campos Específicos**, descritos a seguir:

### Funções

| Nome                                          | Descritivo                                                                                                                                                                                     | Regras de Negócio                                                                            | Integrador  |
| :-------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------- | :---------: |
| Consultar Tributação                          | Aciona a Consulta Tributária conforme Integrador ativado                                                                                                                                       | Solicitar Acesso Restrito para a Operação [Ver Seção Acessos Restritos](#acessos-restritos)  |  **Todos**  |
| Consultar Histórico de Alterações Tributárias | Aciona a visualização do Histórico de Alterações do Produto                                                                                                                                    | Solicitar Acesso Restrito para a Operação [Ver Seção Acessos Restritos](#acessos-restritos)  | **iMendes** |
| Desfazer Alterações Tributárias               | Aciona a Função contida no Histórico de Alterações para que o Usuário possa reverter dados Tributários atualizados pelo Integrador com possibilidade de escolha do ponto de reversão desejado. | Solicitar Acesso Restrito para a Operação. [Ver Seção Acessos Restritos](#acessos-restritos) | **iMendes** |

### Novos Campos

| Tipo                 | Posicionamento                | Nome/Texto                             | Descritivo                                                                                                                                                                                                                                                                                                                                                                   | Regras de Negócio                                                                                         | Integrador  |
| :------------------- | :---------------------------- | :------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------- | :---------: |
| **Campo**            | **Grupo de Dados do Produto** | Código do Integrador                   | Campo para armazenar e exibir o Código do Produto da Base do Integrador, quando ocorrer o vínculo efetuado pelo Usuário durante a Consulta por Descrição, quando o Integrador possui tal recurso.                                                                                                                                                                            | Tipo Numérico Inteiro e Somente Leitura                                                                   |  **Todos**  |
| **Campo**            | A definir                     | Auditado por (Integrador Fiscal)       | Campo para armazenar e exibir a informação de que o Produto teve a tributação auditada/atualizada pelo Integrador Fiscal. Complementar esta informação com a Data/Hora da última atualização tributária.                                                                                                                                                                     | Somente leitura e visualmente destacado.                                                                  | **iMendes** |
| **Campo**            | A definir                     | Enviado para Integrador Fiscal         | Campo para armazenar e exibir a informação de que o Produto foi enviado para Revisão Tributária para o Integrador Fiscal. Será utilizado para identificar quais Produtos estão pendentes de recepção da Tributação do Integrador, e como _flag_ para indicar que precisa receber atualização. Complementar esta informação com a Data/Hora do envio.                         | Criar Siglas específicas, que representem a real situação. Campo Somente leitura e visualmente destacado. |  **Todos**  |
| **Caixa de Seleção** | A definir                     | **Não Tributar por Integrador Fiscal** | Parâmetro para restringir a atualização de Tributos do Produto pelo Integrador Fiscal ativo, quando o Integrador permite tal recurso. Por decisão do Usuário, alguns produtos podem ser tributados seguindo a sua própria interpretação ou por orientação de sua contabilidade, e não deverão receber atualizações tributárias do Integrador ou serem enviados para revisão. | Solicitar Acesso Restrito. [Ver Seção Acessos Restritos](#acessos-restritos).                             |

## Regra Fiscal Ganso

Nesta Seção são descritos os Ajustes e Novos Campos necessários para que as Integrações Fiscais sejam padronizadas.

| Tipo de Elemento        | Nome/Texto                   | Descritivo                                                                                                                                                                                                                                                                                           | Regra de Negócio                                                                                                                                                                                                                                          | Integrador |
| :---------------------- | :--------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------: |
| **Caixa de Combinação** | Tipo de Regra Fiscal         | Campo para identificar e exibir o Tipo de Regra Fiscal (Entrada ou Saída) criada.                                                                                                                                                                                                                    | O campo existe no Banco de Dados (TIPO_OPERACAO), contudo não é exibido em tela. Deve ser exibido a partir de agora, e deve controlar a exibição de componentes em tela.                                                                                  | **Todos**  |
| Flag                    | Criado por Integrador Fiscal | Campo para sinalizar que a Regra Fiscal foi criada por um Integrador Fiscal (Sim/Não) através de um retorno de Consulta Tributária                                                                                                                                                                   | Deve ser apenas uma Flag indicativa. Ativar apenas se o Parâmetro "Permitir Criar Regras Fiscais" estiver ativado. [Ver Seção Parâmetros](#parâmetros-imendes). <br><br> Bloquear a Edição de Regras criadas pelo Integrador com esta flag igual a "Sim". | **Todos**  |
| Campo Numérico          | Código Regra Integrador      | Campo para armazenar o Código da Regra Fiscal da Base do Integrador, quando devolvido pela API. Esta informação será utilizada para eventuais atualizações da Própria Regra do Integrador, para evitar que Regras Fiscais em duplicidade possam ser criadas, e para eventuais soluções de problemas. | Armazenar o Código da Regra retornado pela API no campo especificado.                                                                                                                                                                                     | **Todos**  |
| Campo Texto             | Amparo Legal                 | Campo para informar dados sobre a Legislação Vigente que impõe as informações tributárias da Regra Fiscal criada.                                                                                                                                                                                    | Deve conter espaço para informar textos de até 1024 caracteres.                                                                                                                                                                                           | **Todos**  |
| Campo Texto             | UFs de Destino               | Campo para informar as UFs de Destino da Regra Fiscal quando esta tratar-se de uma Regra do Tipo "Saída".                                                                                                                                                                                            | Preenchimento Obrigatório quando o Tipo igual a "Saída". Desabilitar o campo quando o Tipo igual a "Entrada".                                                                                                                                             | **Todos**  |

## Nova Tela - Gerenciador Tributário

O Integrador **iMendes** oferece opção para Usuário consultar a Tributação de vários produtos em uma única Requisição (em Lote), obtendo retorno imediato conforme as configurações da Operação solicitada. Além disso, permite o envio do Cadastro Completo para revisão. Os integradores **FGF** e **Mix Fiscal** permitem apenas o envio do Cadastro Completo para Revisão Tributária (em Lote). Deste modo é necessário criar uma Nova Tela para o recurso ao Usuário. A seguir, estão descritos os Recursos que esta Nova Tela deve disponibilizar.

| Elemento            | Posicionamento                               | Nome/Texto                                 | Descritivo                                                                                                                                                                        | Conjunto de Dados e Opções                                                                                                                                                                                                                                                                                 | Regras de Negócio                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| :------------------ | :------------------------------------------- | :----------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Grupo de Filtros    | Posição 1                                    | Segmentação                                | Grupo que organiza os campos para pesquisa de Produtos por Segmentação do Sistema Ganso.                                                                                          | Filtros de Marca, Seção, Grupo, Subgrupo, Ambiente de Utilização, Fornecedor Padrão e Agrupamento de Preços.                                                                                                                                                                                               | Validar Hierarquia de Segmentação                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Grupo de Filtros    | Posição 2                                    | Produto                                    | Grupo que organiza os campos para pesquisa de Produtos por Características.                                                                                                       | Filtros "Contém, Começa Com, Igual a" para os campos **Descrição, Referência do Fabricante, Referência Auxiliar e Localização**, Status do Produto, Empresas (Filiais), Caixas de Seleção para as opções **Produtos com EAN/GTIN, Produtos Enviados para Integrador Fiscal, Produtos com Código iMendes**. | A opção **"Produtos com EAN/GTIN"** deve retornar apenas produtos cujo Código de Barras seja maior ou igual a 8 dígitos. <br><br> A opção **"Produtos Enviados para Integrador Fiscal"** refere-se ao itens que foram enviados uma vez em Lote para Revisão Tributária. <br><br> A opção **"Produtos com Código iMendes"** deverá ser exibida apenas se o Integrador ativo for igual a **iMendes** e listar apenas produtos que possuírem a informação preenchida no Cadastro de Produtos. |
| Botão               | Grupo de Filtros do Produto                  | Limpar filtros                             | Botão que aciona o comando para limpar todos os filtros, inclusive os do Grupo Segmentação                                                                                        | Todos os filtros                                                                                                                                                                                                                                                                                           | Exibir uma Mensagem de Confirmação e decisão do Usuário.                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Botão               | Grupo de Filtros do Produto                  | Pesquisar                                  | Botão que aciona a pesquisa considerando os filtros informados, inclusive os do Grupo Segmentação.                                                                                | Todos os filtros                                                                                                                                                                                                                                                                                           | Verificar se nenhum filtro foi preenchido, se sim, informar ao Usuário que a Consulta retornará **todos os produtos**. <br><br> Se Integrador Ativo igual a **iMendes**, informar que mesmo listando todos os Produtos, apenas os X Produtos serão enviados por lote devido a limitação da API. [Ver Seção Parâmetros iMendes](#parâmetros-imendes)                                                                                                                                        |
| Grade de Dados      | Posição 3                                    | Resultado dos Filtros                      | Tabela de Dados contendo os Produtos resultantes dos filtros informandos pelo usuário.                                                                                            | Caixa de Seleção, Código, Código de Barras, Descrição, NCM, CEST, Marca, Seção, Grupo, Subgrupo, Código iMendes, Enviado para Integrador Fiscal ([Ver Seção Cadastro de Produtos](#cadastro-de-produtos))                                                                                                  | Permitir selecionar um ou mais Produtos do Resultado. <br><br>Permitir configurar as colunas a exibir na Grade de Dados. Exibir um "_hint_" quando o usuário passar o mouse sobre um Produto, que exibe os dados Tributários **Antes e Depois**. <br><br> Observar a Limitação de Produtos do Integrador **iMendes** ([Ver Seção Parâmetros iMendes](#parâmetros-imendes))                                                                                                                 |
| Texto               | Abaixo da Grade de Resultado - lado esquerdo | [F4] - Selecionar Todos/Inverter Seleção   | Ação para permitir selecionar Todos os Produtos da Grade de Resultado ou Inverter a Seleção atual                                                                                 | Todos os dados da Grade de Resultado                                                                                                                                                                                                                                                                       | Permitir selecionar o inverter a seleção dos Produtos do Resultado usando a Tecla de Atalho. <br><br> Observar o Limite de Seleção do Integrador **iMendes** ([Ver Seção Parâmetros iMendes](#parâmetros-imendes))                                                                                                                                                                                                                                                                         |
| Texto               | Abaixo da Grade de Resultado - lado esquerdo | [F5] - Limpar Seleção                      | Ação para permitir limpar a Seleção atual da Grade de Resultado dos Filtros                                                                                                       | Todos os dados da Grade de Resultado                                                                                                                                                                                                                                                                       | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Texto               | Abaixo Grade de Resultado - lado direito     | Produtos Listados                          | Texto informativo que exibe o contador total de Produtos que a pesquisa retornou.                                                                                                 | Produtos da Grade de Resultado                                                                                                                                                                                                                                                                             | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Texto               | Abaixo Grade de Resultado - lado direito     | Produtos Selecionados                      | Texto informativo que exibe o contador de Produtos selecionados pelo Usuário.                                                                                                     | Produtos da Grade de Resultado                                                                                                                                                                                                                                                                             | -                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Grupo de Parâmetros | Posição 4                                    | Parâmetros para Consulta Tributária        | Grupo que organiza os filtros específicos e as funções que estarão disponíveis conforme Integrador Ativo.                                                                         | Finalidade de Operação e Cenário Fiscal. Característica Tributária e Perfil Fiscal. UF de Origem e Destino.                                                                                                                                                                                                | Habilitar componentes conforme o Integrador Ativo. Ver definições dos próximos elementos.                                                                                                                                                                                                                                                                                                                                                                                                  |
| Caixa de Combinação | Grupo de Parâmetros para Consulta Tributária | Finalidade da Operação ou Cenário Fiscal   | Campo para definir a Finalidade da Operação (quando Integrador igual a **iMendes**) ou Cenário Fiscal (quando Integrador igual a **Mix Fiscal**)                                  | **Cadastro de Finalidade de Operação** ([Ver Seção Cadastro de Finalidade de Operações](#cadastro-de-finalidade-de-operações))                                                                                                                                                                             | Deve existir uma Finalidade de Operação vinculada a uma Finalidade de Produto ou Cenário Fiscal. <br><br> Se Integrador igual a **iMendes** exibir a lista de **Finalidades de Produto**. <br><br> Se Integrador igual a **Mix Fiscal** exibir a lista de **Cenários Fiscal**. Se Integrador igual a **FGF** desabilitar este campo.                                                                                                                                                       |
| Caixa de Combinação | Grupo de Parâmetros para Consulta Tributária | Característica Tributária ou Perfil Fiscal | Campo para definir a Característica Tributária a enviar na Requisição                                                                                                             | **Cadastro de Perfil Fiscal** ([Ver Seção Cadastro de Perfil Fiscal](#cadastro-de-perfil-fiscal))                                                                                                                                                                                                          | Deve existir um Perfil Fiscal vinculado a uma Característica Tributária. <br><br> Campo exclusivo do Integrador **iMendes**. <br><br> Desabilitar para os Integradores **FGF e Mix Fiscal**.                                                                                                                                                                                                                                                                                               |
| Campo de Texto      | Grupo de Parâmetros para Consulta Tributária | UFs de Origem/Destino                      | Campo para definir as UFs para as quais o usuário deseja obter as Tributações.                                                                                                    | Unidades Federadas Brasileiras                                                                                                                                                                                                                                                                             | Permitir a digitação de mais de uma UF, separadas por vírgula, limitada até 5 UFs. <br><br>Validar se a UF digitada é válida, e não permitir a digitação de UFs repetidas.                                                                                                                                                                                                                                                                                                                 |
| Botão               | Grupo de Parâmetros para Consulta Tributária | Enviar Lote para Revisão                   | Botão para acionar o Envio dos Produtos selecionados para Revisão Tributária pelo Integrador Fiscal.                                                                              | Todos os Produtos Selecionados                                                                                                                                                                                                                                                                             | Verificar Integrador Ativo. Se Integrador igual a **iMendes** [Ver Seção Consulta Avançada iMendes - Gerenciador Tributário](#consulta-avançada-imendes---gerenciador-tributário).<br><br> Se Integrador igual a **FGF** [Ver Seção Requisitos para Integração FGF](#requisitos-da-integração-fgf). <br><br>Se Integrador igual a **Mix Fiscal** [Ver Seção Requisitos para Integração Mix Fiscal](#requisitos-da-integração-mix-fiscal).                                                  |
| Botão               | Grupo de Parâmetros para Consulta Tributária | Consultar Tributação                       | Botão para acionar o comando de Consultar Tributação para os produtos selecionados na Grade de Dados.                                                                             | Produtos Selecionados                                                                                                                                                                                                                                                                                      | Se Integrador igual a **iMendes** verificar cada Produto da Seleção para definir o Método de Consulta ([Ver Seção Métodos de Consulta](#métodos-de-consulta)) e combinar com os demais Parâmetros deste grupo (Finalidade de Operação, Característica Tributária e UFs).<br><br> Se Integrador igual a **FGF e Mix Fiscal** desabilitar esta função.                                                                                                                                       |
| Botão               | Grupo de Parâmetros para Consulta Tributária | Consultar Alterações                       | Botão para acionar o comando para Consultar Alterações de Tributação para os produtos selecionados na Grade de Dados (depende do Integrador)                                      | Todos os dados                                                                                                                                                                                                                                                                                             | Se Integrador igual a **iMendes** utilizar o **Método Consulta Alterados** [Ver Seção Recursos Adicionais iMendes](#recursos-adicionais-imendes).<br><br> Se Integrador igual a **FGF ou Mix Fiscal** utilizar o **Método de Recepção** [Ver Seção Requisitos para Integração FGF](#requisitos-da-integração-fgf) e [Ver Seção Requisitos para Integração Mix Fiscal](#requisitos-da-integração-mix-fiscal), respectivamente.                                                              |
| Botão               | Grupo de Parâmetros para Consulta Tributária | Pendentes/Devolvidos                       | Botão para acionar o Recurso Específico do Integrador **iMendes** para remover os produtos da Base iMendes [Ver Seção Recursos Adicionais iMendes](#recursos-adicionais-imendes). | Produtos na Base iMendes                                                                                                                                                                                                                                                                                   | Desabilitar para os demais Integradores.                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

O _Wireframe_ abaixo ilustra os elementos descritos acima para a Nova Tela.

![Wireframe - Nova Tela - Gerenciador Tributário](./Wireframe-Tax-Manager0.png)

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Nova Tela - Comparativo de Tributos (Antes x Depois)

Os Integradores Fiscais **iMendes e Mix Fiscal** relacionados nesta documentação sugerem que o Usuário Final visualize quais informações Tributárias estão sendo atualizadas através de uma Tela Comparativa, e especificamente o **iMendes**, sugere que seja oferecida opção para aceitar parcialmente as informações. Deste modo é necessário criar uma Tela Genérica que contempla a Relação de campos elegíveis para atualização, contendo os recursos descritos abaixo:

| Tipo de Elemento   | Posicionamento        | Nome/Texto           | Descritivo                                                                                                                                                                                                                   | Regras de Negócio                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :----------------- | :-------------------- | :------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Grupo**          | -                     | Dados do Produto     | Organiza as informações básicas do Produto                                                                                                                                                                                   | Somente Leitura                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Campo**          | **Dados do Produto**  | Código Interno       | Código do Produto Ganso                                                                                                                                                                                                      | Somente Leitura                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Campo**          | **Dados do Produto**  | Código de Barras     | Código de Barras Padrão EAN/GTIN                                                                                                                                                                                             | Somente Leitura                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Campo**          | **Dados do Produto**  | Descrição            | Descrição do Produto Ganso                                                                                                                                                                                                   | Somente Leitura                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Campo**          | **Dados do Produto**  | Código iMendes       | Código iMendes vinculado ao Produto Consultado                                                                                                                                                                               | Somente Leitura. Exibir somente se o Integrador **iMendes** estiver ativo                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Grade de Dados** | Lado esquerdo da Tela | **Tributação Atual** | Grade de dados para exibir todos os campos relacionados à Tributação Atual Gravada no Produto (antes da atualização). [Ver Seção Relação de Campos Ganso x Integrador Fiscal](#-relação-de-campos-ganso-x-integrador-fiscal) | Sempre exibir os dados atuais do Produto Cadastrado no Sistema Ganso. Somente leitura.                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Grade de Dados** | Lado direito da Tela  | **Tributação Nova**  | Grade de dados para exibir todos os campos relacionados à Tributação Nova **retornados pela API do Integrador**. [Ver Seção Relação de Campos Ganso x Integrador Fiscal](#-relação-de-campos-ganso-x-integrador-fiscal)      | Se Integrador **iMendes** ativado, exibir uma **Caixa de Seleção** que permita o Usuário aceitar parcialmente a tributação de um Produto, ou seja, selecionar quais tributos serão atualizados. [Ver Seção Relação de Campos Ganso x Integrador Fiscal](#-relação-de-campos-ganso-x-integrador-fiscal) que aponta quais informações são dependentes. Não exibir a Caixa de Seleção para o Integrador **Mix Fiscal**. <br><br>O Integrador FGF possui portal próprio para visualização. |
| **Botão**          | -                     | **Confirmar**        | Botão para confirmar a atualização dos Tributos                                                                                                                                                                              | Solicitar Acesso Restrito [Ver Seção Acessos Restritos](#acessos-restritos) e Gravar em Log ([Ver Seção Logs em Requisitos de Segurança](#logs)) os campos não selecionados (quando ocorrer).                                                                                                                                                                                                                                                                                          |

A seguir, o _Wireframe_ ilustra os elementos descritos na Tabela acima:

![Wireframe Comparativo](./Wireframe-Screen-Decision.png)

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Nova Tela - Consulta por Descrição de Produto

O Integrador **iMendes** possui um recurso importante para garantir que o Usuário consiga informações Tributárias de todos os seus Produtos, mesmo os que não possuírem **Código de Barras** padronizado. Trata-se da **Pesquisa por Descrição**, em que é oferecida a Base de Dados **iMendes** para que o Usuário relacione o seu Produto e efetue a Consulta Tributária conforme desejado. Este recurso deve ser disponibilizado apenas na **Consulta Básica através do Cadastro de Produtos** e deve ser acionada conforme as Regras de Negócio abaixo:

|                       Ação do Usuário                        | Dados Inseridos                                                        | Mensagem ao Usuário                                                                                                                                                                           | Decisão                                                                                                                                                                                                                                                                                                                                                                                                      | Validações                                                                                                                                                                             |
| :----------------------------------------------------------: | :--------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|                   Cadastrando Novo Produto                   | Apenas Descrição do Produto                                            | Informar que a Consulta Tributária ocorrerá através da Descrição e que o Usuário deverá tomar a decisão em vincular um **Código iMendes** para futuras consultas.                             | Utilizar o [**Método de Consulta 2**](#métodos-de-consulta) e exibir os Produtos encontrados                                                                                                                                                                                                                                                                                                                 | Solicitar Chave de Acesso Restrito para vincular Código iMendes. [Ver Seção Acessos Restritos](#acessos-restritos)                                                                     |
| Cadastrando Novo Produto ou Utilizando um Produto Cadastrado | Descrição e Código de Barras inválido, mas com 8, 12, 13 ou 14 dígitos | Informar que o Código de Barras é inválido e solicitar que o usuário verifique o Código. Disponibilizar as opções para **"Continuar por Descrição"** e **"Continuar pelo Código de Barras"**. | Se Usuário **"Continuar por Descrição"**, exibir mensagem informando que a consulta ocorrerá através da Descrição, e utilizar o [**Método de Consulta 2**](#métodos-de-consulta) e exibir os Produtos encontrados.<br><br> Se Usuário **"Continuar pelo Código de Barras"**, utilizar o [**Método de Consulta 1**](#métodos-de-consulta) e exibir mensagem informando que o Produto pode não ser encontrado. | Aplicar método de validação do Código de Barras pelo dígito verificador. <br><br> Exibir mensagem clara e objetiva sobre possível falha do Processo "Continuar pelo Código de Barras". |

![Nova Tela - Consulta por Descrição](./Wireframe-Screen-Description-Consulting.png)

# Relação de Campos Ganso x Integrador Fiscal

Nesta Seção são descritos os **Relacionamentos das Informações** que são retornadas pelas APIs dos Integradores Fiscais, e os respectivos Campos de Informações do Sistema Ganso que deverão receber os dados. A relação está divida em 2 tabelas: **Produto e Produto Parâmetros** quando as informações tributárias compõe apenas dados do **Cadastro do Produto**. Nas Seções envolvendo a Regra Fiscal terão uma nova relação por tratar-se de Estruturas distintas.

## Tabela Produto

| Campo do Ganso          | Descritivo                                   | Retorno iMendes | Retorno FGF | Retorno Mix Fiscal | Regra de Negócio                                                                                                                   |
| :---------------------- | :------------------------------------------- | :-------------: | :---------: | :----------------: | :--------------------------------------------------------------------------------------------------------------------------------- |
| NCM                     | NCM do Produto                               |      `nCM`      |  `codNcm`   |       `ncm`        | -                                                                                                                                  |
| CEST                    | Código CEST do Produto                       |     `cEST`      |  `codCest`  |       `cest`       | Se Integrador igual a **iMendes** remover a máscara do retorno e gravar apenas os dígitos.                                         |
| prod_esp_com_codigo_anp | Código ANP do Produto Específico Combustível |    `codAnp`     |      -      |         -          | Se existir retorno para esta informação, gravar o Código ANP no Produto e preencher o campo "PRODUTO_ESPECIFICO" com a sigla 'COM' |
| ex_tipi                 | Exclusão da TIPI                             |      `ex`       |  `exTipi`   |      `ex_ipi`      | -                                                                                                                                  |

## Tabela Produto Parâmetros

| Campo do Ganso                                  | Descritivo                                                                    |                       Retorno iMendes                        |                           Retorno FGF                           |   Retorno Mix Fiscal   | Regra de Negócio                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| :---------------------------------------------- | :---------------------------------------------------------------------------- | :----------------------------------------------------------: | :-------------------------------------------------------------: | :--------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| cst_pis_entrada                                 | CST de PIS de Entrada                                                         |                      `pisCofins/cstEnt`                      |                      `cstPisCofinsEntrada`                      |   `cst_entrada_pis`    | O CST de PIS de Entrada deve ser igual ao CST de Cofins de Entrada. Somente o Integrador Mix Fiscal diferencia os campos de Entrada                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| cst_cofins_entrada                              | CST de Cofins de Entrada                                                      |                      `pisCofins/cstEnt`                      |                      `cstPisCofinsEntrada`                      |  `cst_entrada_cofins`  | O CST de Cofins de Entrada deve ser igual ao CST de PIS de Entrada. Somente o Integrador Mix Fiscal diferencia os campos de Entrada                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| cst_pis                                         | CST de PIS de Saída                                                           |                      `pisCofins/cstSai`                      |                       `cstPisCofinsSaida`                       |    `cst_saida_pis`     | O CST de PIS de Saída deve ser igual ao CST de Cofins de Saída. Somente o Integrador Mix Fiscal diferencia os campos de Saída                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| cst_cofins                                      | CST de Cofins de Saída                                                        |                      `pisCofins/cstSai`                      |                       `cstPisCofinsSaida`                       |   `cst_saida_cofins`   | O CST de PIS de Saída deve ser igual ao CST de Cofins de Saída. Somente o Integrador Mix Fiscal diferencia os campos de Saída                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| codigo_tributo_pis_entrada / f_pis_compra       | Alíquota de PIS de Entrada                                                    |                     `pisCofins/aliqPis`                      |                           `al_pis_in`                           |   `aliq_entrada_pis`   | Gravar o Código do Tributo do PIS que consta na Tabela "TRIBUTOS" do Sistema Ganso, que corresponde à Alíquota retornada pelo parceiro. Gravar a Alíquota no campo f_pis_compra.                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| codigo_tributo_cofins_entrada / f_cofins_compra | Alíquota de Cofins de Entrada                                                 |                    `pisCofins/aliqCofins`                    |                         `al_cofins_in`                          | `aliq_entrada_cofins`  | Gravar o Código do Tributo do Cofins que consta na Tabela "TRIBUTOS" do Sistema Ganso, que corresponde à Alíquota retornada pelo parceiro. Gravar a Alíquota no campo f_cofins_compra.                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| codigo_tributo_pis_saida / f_pis_venda          | Alíquota de PIS de Saída                                                      |                     `pisCofins/aliqPis`                      |                          `al_pis_out`                           |    `aliq_saida_pis`    | Gravar o Código do Tributo do PIS que consta na Tabela "TRIBUTOS" do Sistema Ganso, que corresponde à Alíquota retornada pelo parceiro. Gravar a Alíquota no campo f_pis_venda.                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| codigo_tributo_cofins_saida / f_cofins_venda    | Alíquota de Cofins de Saída                                                   |                    `pisCofins/aliqCofins`                    |                         `al_cofins_out`                         |  `aliq_saida_cofins`   | Gravar o Código do Tributo do Cofins que consta na Tabela "TRIBUTOS" do Sistema Ganso, que corresponde à Alíquota retornada pelo parceiro. Gravar a Alíquota no campo f_cofins_venda.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| cst_natureza_receita_piscofins                  | CST da Natureza da Receita de PIS e Cofins                                    |                       `pisCofins/nri`                        |                        `naturezaReceita`                        |       `nat_rec`        | Verificar a existência do Código de Natureza da Receita (campo "codigo_natureza_receita" da tabela "NATUREZA_RECEITA") onde os campos "cst_pis" e "cst_cofins" correspondem ao CST de PIS e Cofins retornados pelo Integrador. Se existir, gravar no Campo do Ganso. Se não existir, criar um Registro Genérico na Tabela "NATUREZA_RECEITA" preenchendo os campos: <br> CODIGO_NATUREZA_RECEITA: Código Retornado pelo Integrador <br> NATUREZA_RECEITA: 'Natureza criada pelo Integrador (x)' <br> CST_PIS e CST_COFINS: CST de PIS e Cofins Retornados pelo Integrador, tanto de entrada quanto de saída, separados por vírgula. Ex.: '70,06' |
| cst_ipi_entrada                                 | CST de IPI de Entrada                                                         |                         `iPI/cstEnt`                         |                                -                                |           -            | Informar o Código de Retorno no Campo de destino. Somente o Integrador iMendes fornece retorno para este campo.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| cst_ipi                                         | CST de IPI de Saída                                                           |                         `iPI/cstSai`                         |                                -                                |           -            | Informar o Código de Retorno no Campo de destino. Somente o Integrador iMendes fornece retorno para este campo.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| codigo_tributo_ipi                              | Alíquota de IPI de Saída                                                      |                        `iPI/aliqipi`                         |                                -                                |           -            | Gravar o Código do Tributo que consta na Tabela "PRODUTO_TRIBUTO" onde o campo "SITUACAO" seja igual a 1, "SITUACAO_TRIBUTARIA" seja igua a 'T' e o campo "CST" corresponda ao valor retornado pelo Integrador.                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| codigo_cfop_nfc                                 | Código Fiscal de Operação ou Prestação (CFOP) de Saída                        |                       `CaracTrib/cFOP`                       |                                -                                |           -            | Somente o Integrador **iMendes** retorna esta informação, contudo é obrigatória para o Sistema Ganso. Para os demais parceiros, preencher com '5102' se "CST de ICMS de Saída" diferente de '60' e preencher com '5405' se "CST de ICMS de Saída" igual a '60'.                                                                                                                                                                                                                                                                                                                                                                                  |
| cst                                             | CST de ICMS de Saída                                                          |                       `CaracTrib/cST`                        |                         `cstIcmsSaida`                          |       `cst_icms`       | Concatenar o dígito '0' como prefixo quando o Integrador for igual a **iMendes ou Mix Fiscal**. O Integrador **FGF** retornará os 3 dígitos requeridos pelo Sistema Ganso.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| cst_nfc                                         | CST de ICMS de Saída (NFC-e/SAT)                                              |                       `CaracTrib/cST`                        |                         `cstIcmsSaida`                          |       `cst_icms`       | Concatenar o dígito '0' como prefixo quando o Integrador for igual a **iMendes ou Mix Fiscal**. O Integrador **FGF** retornará os 3 dígitos requeridos pelo Sistema Ganso.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| csosn                                           | CSOSN de ICMS de Saída - Se CRT = 1 ou 2                                      |                      `CaracTrib/cSOSN`                       |                         `cstIcmsSaida`                          |       `cst_icms`       | Concatenar o dígito '0' como prefixo quando o Integrador for igual a **iMendes ou Mix Fiscal**. O Integrador **FGF** retornará os 4 dígitos requeridos pelo Sistema Ganso.                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| csosn_nfc                                       | CSOSN de ICMS de Saída (NFC-e/SAT)                                            |                      `CaracTrib/cSOSN`                       |                         `cstIcmsSaida`                          |       `cst_icms`       | Concatenar o dígito '0' como prefixo quando o Integrador for igual a **iMendes ou Mix Fiscal**. O Integrador **FGF** retornará os 4 dígitos requeridos pelo Sistema Ganso. Gravar somente se CRT da Empresa igual 1 ou 2.                                                                                                                                                                                                                                                                                                                                                                                                                        |
| f_rbc_icms_sai_estadual                         | Percentual de Redução de Base de Cálculo do ICMS Estadual                     |                  `CaracTrib/reducaoBcIcms`                   |                        `perReducaoSaida`                        |    `redbase_saida`     | Informar no campo de destino o valor retornado pelo Integrador.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| f_st_rbc_icms_sai_estadual                      | `CaracTrib/reducaoBcIcmsSt`                                                   | Percentual de Redução de Base de Cálculo do ICMS ST Estadual | Informar no campo de destino o valor retornado pelo Integrador. |
| f_rbc_icms_sai_interestadual                    | Percenutal de Redução de Base de Cálculo do ICMS Interestadual                |              `CaracTrib/redBcIcmsInterestadual`              |                                -                                |           -            | \* Verificar com FGF e Mix Fiscal este retorno.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| f_st_mva_saida                                  | Percentual de Margem de Valor Agregado ou Índice de Valor Agregado de Saída   |                       `CaracTrib/iVA`                        |                  `perMva/perMvaInterestadual`                   |         `mva`          | \* Verificar FGF qual campo utilizar.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| f_st_mva                                        | Percentual de Margem de Valor Agregado ou Índice de Valor Agregado de Entrada |                     `CaracTrib/iVAAjust`                     |                  `perMva/perMvaInterestadual`                   |         `mva`          | \* Verificar FGF qual campo utilizar.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| percentual_fcp                                  | Percentual de Entrada do Fundo de Combate a Pobreza                           |                       `CaracTrib/fCP`                        |                            `perFcp`                             |         `fecp`         | Informar no campo de destino o valor retornado pelo Integrador.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| cod_beneficio_fiscal                            | Código do Benefício Fiscal de Saída                                           |                     `CaracTrib/codBenef`                     |                  `CodBenefAjusteIncentivoCST`                   |        `cBenef`        | Informar no campo de destino o valor retornado pelo Integrador.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| percentual_diferimento                          | Percentual de Diferimento de Entrada                                          |                      `CaracTrib/pDifer`                      |                   `AliqIcmsDesoneradoEntrada`                   |           -            | \* Verificar com FGF e Mix Fiscal qual campo utilizar.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| codigo_tributo                                  | Código do Tributo de ICMS de Saída Estadual para NFC-e/SAT-CF-e               |                      `infPDV/pICMSPDV`                       |                        `perAliqPDVSaida`                        | `aliq_icms/aliq_saida` | Gravar o Código do Tributo que consta na Tabela "PRODUTO_TRIBUTO" onde o campo "SITUACAO" seja igual a 0, "SITUACAO_TRIBUTARIA" seja igua a 'T' e o campo "CST" corresponda ao valor retornado pelo Integrador. Se valor retornado igual a 0, verificar se campo o "SITUACAO_TRIBUTARIA" é igual a:<br> **iMendes:** `infPDV/simbPDV`<br> **FGF**: `tipoTributacaoPDV`<br> **Mix Fiscal**: dependerá do cenário\*.                                                                                                                                                                                                                               |
| f_icms_venda                                    | Alíquota de ICMS de Saída Estadual para NFC-e/SAT-CF-e                        |                      `infPDV/pICMSPDV`                       |                        `perAliqPDVSaida`                        | `aliq_icms/aliq_saida` | Gravar o valor retornado pelo Integrador.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Campos Dependentes

O Integrador **iMendes** disponibiliza recurso para o Usuário decidir quais tributos poderão ser Atualizados durante a Consulta através do Cadastro do Produto. Contudo, determinadas informações tributárias são dependentes, e não podem ser ignoradas individualmente. Portanto, abaixo estão elencados os campos dependentes por Grupo de Impostos.

| Grupo de Impostos    | Campos Dependentes                                               |  Tabela Referenciada   | Regra de Negócio                                                                                                                 |
| :------------------- | :--------------------------------------------------------------- | :--------------------: | :------------------------------------------------------------------------------------------------------------------------------- |
| ICMS                 | **codigo_tributo, cst, cst_nfc, csosn, csosn_nfc, f_icms_venda** | **Produto Parâmetros** | Se usuário desmarcar um dos campos, todos os demais relacionados deverão ser desmarcados também.                                 |
| PIS e COFINS Entrada | **cst_pis_entrada e cst_cofins_entrada**                         | **Produto Parâmetros** | Ambos CSTs devem ser iguais, trata-se de impostos "gêmeos". O usuário não pode desmarcar apenas um CST de PIS/COFINS de Entrada. |
| PIS e COFINS Saída   | **cst_pis e cst_cofins**                                         | **Produto Parâmetros** | Ambos CSTs devem ser iguais, trata-se de impostos "gêmeos". O usuário não pode desmarcar apenas um CST de PIS/COFINS de Saída.   |
| IPI                  | **codigo_tributo_ipi e cst_ipi**                                 | **Produto Parâmetros** | Se usuário desmarcar um dos campos, o outro deve ser desmarcado também.                                                          |

---

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

## Regra Fiscal x Integrador Fiscal

Os Integradores Fiscais possuem dados para alimentar a Regra Fiscal de Entrada e Saída do Sistema Ganso. A Tabela a seguir aponta quais campos obrigatórios da **Regra Fiscal Ganso** devem ser alimentados pelo Retorno da **Consulta Avançada** para cada Integrador.

| Campo do Ganso              | Tabela              | Descritivo                                                 |                         Retorno iMendes                          |                                         Retorno FGF                                         |                                     Retorno Mix Fiscal                                      | Regra de Negócio                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :-------------------------- | :------------------ | :--------------------------------------------------------- | :--------------------------------------------------------------: | :-----------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| descricao                   | produto_prf         | Descrição da Regra Fiscal                                  |                                -                                 |                                              -                                              |                                              -                                              | Criar uma descrição padronizada utilizando dados das informações tributárias de retorno. Sugestão: "RF INTEGRADOR - [Tipo] NCM [NCM] - [CARACTERÍSTICA TRIBUTÁRIA] - [UF]"                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| codigo_filial               | produto_prf         | Código da Filial de Consulta                               |                                -                                 |                                              -                                              |                                              -                                              | Preencher com o Código da Filial que realizou a Consulta                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| data_inicial                | produto_prf         | Data de Vigência Inicial                                   |                                -                                 |                                              -                                              |                                              -                                              | Preencher com a Data Atual da Criação da Regra                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| data_final                  | produto_prf         | Data de Vigência Final                                     |                                -                                 |                                              -                                              |                                              -                                              | Deixar em branco                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| status                      | produto_prf         | Status da Regra                                            |                                -                                 |                                              -                                              |                                              -                                              | Marcar como "Ativa"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| tipo_operacao               | produto_prf         | Tipo de Regra Fiscal (Entrada ou Saída)                    |                  Depende da Operação Consultada                  |                                      Preencher com 'S'                                      |                                      Preencher com 'S'                                      | Preencher com 'E' ou 'S' conforme disponibilidade de dados do Integrador                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| orig_finalidoperacao        | produto_prf         | Código da Finalidade da Operação consultada                |                      `CaracTrib/finalidade`                      | Preencher com o Código da Finalidade que corresponda à Operação de Venda a Consumidor Final | Preencher com o Código da Finalidade que corresponda à Operação de Venda a Consumidor Final | Preencher com o Código da **Finalidade do Produto** relacionado à Finalidade de Operação cadastrada que foi enviada para Consulta à API. [Ver Seção Cadastro de Finalidade de Operação](#cadastro-de-finalidade-de-operações)                                                                                                                                                                                                                                                                                                                                                                                         |
| orig_perfil_fiscal          | produto_prf         | Código do Perfil Fiscal consultado                         |                        `CaracTrib/codigo`                        |        Preencher com o Código do Perfil Fiscal que corresponda à "Consumidor Final"         |        Preencher com o Código do Perfil Fiscal que corresponda à "Consumidor Final"         | Preencher com o Código da Característica Tributária relacionada ao **Perfil Fiscal** ([Ver Seção Cadastro de Perfil Fiscal](#cadastro-de-perfil-fiscal)) enviado para consulta à API.                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| orig_uf                     | produto_prf         | UFs de Origem consultadas                                  |                         `Regras/uFs/uF`                          |                                              -                                              |                                              -                                              | Preencher com as UFs retornadas na Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **dest_uf**                 | produto_prf         | **Novo Campo**. UFs de Destino consultadas                 |                         `Regras/uFs/uF`                          |                                              -                                              |                                              -                                              | Preencher com as UFs para as quais foram consultadas                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ncm                         | produto_prf         | NCM do Produto                                             |                           `Grupos/nCM`                           |                                            `ncm`                                            |                                            `ncm`                                            | Preencher com o NCM retornado na Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| cest                        | produto_prf         | CEST do Produto                                            |                          `Grupos/cEST`                           |                                           `cest`                                            |                                           `cest`                                            | Preencher com o CEST retornado na Tag correspondente. Eliminar a máscara do retorno deste campo.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| orig_cfop                   | produto_prf         | CFOP de Origem                                             |                         `CaracTrib/cFOP`                         |                                              -                                              |                                              -                                              | Preencher com o CFOP retornado na Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| orig_cst                    | produto_prf         | CST/CSOSN de Origem                                        |                         `CaracTrib/cST`                          |                                              -                                              |                                              -                                              | Preencher com o CST ou CSOSN retornado pela Tag correspondente, complementando o primeiro dígito com o dígito informado no campo **origem** da Tag de Envio `perfil` [Ver Seção Composição da Requisição](#composição-da-requisição)                                                                                                                                                                                                                                                                                                                                                                                  |
| sugere_cfop_sn              | produto_prf         | Definir o CFOP                                             |                                -                                 |                                              -                                              |                                              -                                              | Preencher com 'S' para que o campo de CFOP seja preenchido com a informação retornada da Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| sugere_cfop                 | produto_prf         | CFOP a aplicar                                             |                         `CaracTrib/cFOP`                         |                                              -                                              |                                              -                                              | Preencher com o CFOP retornado pela Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| sugere_icms_cstcsosn_sn     | produto_prf         | Definir CST/CSOSN                                          |                                -                                 |                                              -                                              |                                              -                                              | Preencher com 'S' para que o CST/CSOSN seja preenchido com a informação retornada da Tag correspondente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| sugere_icms_cstcsosn        | produto_prf         | CST/CSOSN a aplicar                                        |               `CaracTrib/cST` ou `CaracTrib/cSOSN`               |                                              -                                              |                                              -                                              | Preencher com o CST ou CSOSN retornado pela Tag correspondente, adicionando como prefixo o dígito enviado no campo `perfil/origem`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| zerar_icms                  | produto_prf         | Zerar ICMS do Produto                                      |                                -                                 |                                              -                                              |                                              -                                              | Se `CaracTrib/cST` = '60' e `CaracTrib/cFOP` = 'x403' ou 'x405' definir como 'S', caso contrário, definir como 'N'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| sugere_icms_aliq_sn         | produto_prf         | Definir Alíquota ICMS                                      |                                -                                 |                                              -                                              |                                              -                                              | Preencher com 'S' se `CaracTrib/cST` diferente de '60' e `CaracTrib/cFOP` diferente de 'x403' ou 'x405'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| codigo_produto_tributo      | produto_prf         | Alíquota de ICMS a Aplicar                                 | `CaracTrib/aliqIcmsInterestadual` ou `CaracTrib/aliqIcmsInterna` |                                              -                                              |                                              -                                              | **Regra 1** - Se UF igual a UF da Empresa Filial e o campo `CaracTrib/cST` igual a '60', preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" seja igual a 'F'. <br><br>**Regra 2** - Se UF igual a UF da Empresa Filial, `CaracTrib/cST` diferente de '60', e campo `CaracTrib/aliqIcmsInterna` maior que "zero", preencher com o Código do Tributo da tabela "PRODUTO_TRIBUTO" onde a "SITUACAO_TRIBUTARIA" igual a 'T' e campo "CST" seja igual ao campo `CaracTrib/aliqIcmsInterna`.                                                                                        |
| sugere_icms_rbc_sn          | produto_prf         | Definir Redução de Base de Cálculo do ICMS                 |                                -                                 |                                              -                                              |                                              -                                              | Preencher com 'S' para que o campo Redução de Base seja preenchido                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| sugere_icms_rbc             | produto_prf         | Percentual da Redução de Base de Cálculo do ICMS a Aplicar |                    `CaracTrib/reducaoBcIcms`                     |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_icms_pdiferimento_sn | produto_prf         | Definir Diferimento                                        |                                -                                 |                                              -                                              |                                              -                                              | Preencher com 'S' se o campo `CaracTrib/pDifer` for maior que zero.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| sugere_icms_pdiferimento    | produto_prf         | Percentual de Diferimento do ICMS                          |                        `CaracTrib/pDifer`                        |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_fcp_aliq_sn          | produto_prf         | Definir FCP                                                |                                -                                 |                                              -                                              |                                              -                                              | Preencher com 'S' se o campo `CaracTrib/fCP` for maior que zero.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| sugere_fcp_aliq             | produto_prf         | Percenutal de FCP                                          |                         `CaracTrib/fCP`                          |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| icmsst_lancamento           | produto_prf         | Lançamento do ICMS ST                                      |                                -                                 |                                              -                                              |                                              -                                              | **Regra 1** - Se `CaracTrib/cST` = '60' e `CaracTrib/cFOP` = '1403' ou '1401', e UF igual a UF da Empresa Filial, definir como 'O' (Original). <br><br> **Regra 2** - Se `CaracTrib/cST` = '10' e `CaracTrib/cFOP` = '2401' ou '2403', `CaracTrib/aliqIcmsInterestadual` diferente de zero, e UF diferente da UF da Empresa Filial, definir como 'D' (Dentro da NF). <br><br>**Regra 3** - Se `CaracTrib/cST` = '60' e `CaracTrib/cFOP` = '2403', `CaracTrib/aliqIcmsInterestadual` diferente de zero, `CaracTrib/iVAAjust` diferente de zero, e UF diferente da UF da Empresa Filial, definir como 'F' (Fora da NF). |
| mod_bc_icms_st              | produto_prf         | Modalidade da Base de Cálculo do ICMS ST                   |                                -                                 |                                              -                                              |                                              -                                              | Se icmsst_lancamento igual a 'D' ou 'F', preencher este campo com o código 4.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| sugere_icmsst_rbc_sn        | produto_prf         | Definir Redução de Base de Cálculo do ICMS ST              |                                -                                 |                                              -                                              |                                              -                                              | Se `CaracTrib/reducaoBcIcmsSt` maior que zero, preencher este campo com 'S', caso contrário, definir como 'N'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_icmsst_rbc           | produto_prf         | Percentual de Redução de Base de Cálculo do ICMS ST        |                   `CaracTrib/reducaoBcIcmsSt`                    |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| icms_st_aliq                | produto_prf         | Alíquota de ICMS ST                                        |                      `CaracTrib/aliqIcmsSt`                      |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_icmsst_fcp_aliq_sn   | produto_prf         | Definir Percentual de FCP                                  |                                -                                 |                                              -                                              |                                              -                                              | Se `CaracTrib/fCP` maior que zero, preencher este campo com 'S'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| sugere_icmsst_fcp_aliq      | produto_prf         | Percentual de FCP ST                                       |                         `CaracTrib/fCP`                          |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_ipi_cst_sn           | produto_prf         | Definir CST de IPI                                         |                                -                                 |                                              -                                              |                                              -                                              | Definir como 'S' para que o campo do CST seja preenchido                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| sugere_ipi_cst              | produto_prf         | CST de IPI de Entrada                                      |                       `Grupos/iPI/cstEnt`                        |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_ipi_aliq_sn          | produto_prf         | Definir Alíquota de IPI                                    |                                -                                 |                                              -                                              |                                              -                                              | Definir como 'S' para que o campo da alíquota seja preenchido.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| sugere_ipi_aliq             | produto_prf         | Alíquota de IPI de Entrada                                 |                       `Grupos/iPI/aliqipi`                       |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| origem_aliquota_icms        | **produto_prf_mva** | Alíquota de Origem do MVA                                  |                `CaracTrib/aliqIcmsInterestadual`                 |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado apenas se maior que Zero, e se o campo **icmsst_lancamento** for definido como 'D' ou 'F'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| mva                         | **produto_prf_mva** | MVA - Margem de Valor Agregado Ajustada                    |                       `CaracTrib/iVAAjust`                       |                                              -                                              |                                              -                                              | Preencher com a informação do campo retornado apenas se o maior que Zero, e se o campo **icmsst_lancamento** for definido como 'D' ou 'F'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

# Requisitos da Regra Fiscal de Saída Ganso

[Voltar ao Sumário](#documentação-de-requisitos---integrações-fiscais) | [Voltar ao Roadmap](#roadmap)

# Requisitos de Segurança

## Acessos Restritos

A seguir a Tabela de Acessos Restritos essenciais para Controle da Integração Fiscal
| Grupo | Descritivo | Regra de Negócio | Dependendência | Integrador |
|:---|:---|:---|:---|:---:|
| Produto | Consultar Tributação de Produtos através do Integrador Fiscal (x) | Impedir que o usuário execute consulta à tributação via função de consulta no Cadastro. | Parâmetro **Permitir Consultar Tributação através do Cadastro de Produtos** [Ver Seção Parâmetros iMendes](#parâmetros-imendes) | **iMendes** |
| Produto | Atualizar Tributação de Produtos através do Integrador Fiscal (x) parcialmente | Impedir que o usuário atualize parcialmente a tributação dos produtos, desmarcando campos no retorno da consulta exibido na [Nova Tela - Comparativo de Tributos Antes x Depois](#nova-tela---comparativo-de-tributos-antes-x-depois) | Parâmetro **Permitir Atualização Parcial das Informações Tributárias do Produto** [Ver Seção Parâmetros iMendes](#parâmetros-imendes) | **iMendes** |
| Produto | Vincular Código iMendes a um Produto Cadastrado | Impedir que o usuário vincule um Código iMendes a um Produto durante a Inserção ou Atualização de Cadastro. | Parâmetro **Permitir Consultar Tributação por Descrição do Produto** [Ver Seção Parâmetros iMendes](#parâmetros-imendes) <br><br>**Nova Tela: Produtos iMendes - Consulta por Descrição** <br><br> **Método de Consulta 2** [Ver Seção Métodos de Consulta iMendes](#métodos-de-consulta) | **iMendes** |
| Produto | Visualizar Histórico de Alterações Tributárias do Produto | Impedir que o Usuário visualize o histórico de atualizações tributárias do Produto | - | **iMendes** |
| Produto | Restaurar Tributação do Produto para o ponto de atualização selecionado no histórico | Impedir que o usuário reverta alterações tributárias ocorridas em qualquer ponto da história do produto | **Logs** [Ver Seção Logs](#logs) | **iMendes** |
| Produto | Ativar parâmetro para Não Tributar o Produto por Integradores Fiscais | Impedir que o Usuário ative o parâmetro do produto que impede o mesmo de ser enviado para Classificação Tributária e de Consultar e atualizar a Tributação (Manualmente ou Automáticamente). <br><br> Não se aplica se o Integrador ativo for igual a **Mix Fiscal** | - | **iMendes e FGF** |
| Cadastro de Finalidade da Operação | Atualizar Cenário Fiscal na API Mix Fiscal | Impedir que o Usuário efetue atualização das informações do Cenário Fiscal criado anteriormente. | - | **Mix Fiscal** |
| Cadastro de Finalidade de Operação | Criar Cenário Fiscal na API Mix Fiscal | Impedir que o Usuário crie Cenário Fiscal com base nas informações inseridas no Cadastro. | - | **Mix Fiscal** |

## Logs

A tabela a seguir, relaciona os Logs necessários por Integrador Fiscal, Regras de Negócio e Dados envolvidos.

| Nome do Log                          | Descritivo                                                               | Regras de Negócio                                                                                                                                                             | Dados                                                                                                                                                                 |   Integrador   |
| :----------------------------------- | :----------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------: |
| Consumo da API                       | Histórico de Acesso ou Consumo da API do Integrador Fiscal               | Armazenar dados da Consulta a cada nova Requisição à API do Integrador.                                                                                                       | Código da Filial, Data, Hora, Usuário de Consulta, Nome do Integrador, Nome da API Consumida, Método de Consulta, Número de Produtos enviados, Resposta da API        |   **Todos**    |
| Produto Log Consulta Tributária      | Histórico de Consultas por Produto                                       | Armazenar dados da Consulta Tributária realizada pelo Produto à API do Integrador.                                                                                            | Código do Produto, Código da Filial, Data, Hora, Usuário de Consulta, Nome do Integrador, Nome da API, Método de Consulta, Resposta da API, Dados de Retorno          |   **Todos**    |
| Produto Log Atualização Tributos     | Histórico de Tributos alterados por Produto                              | Armazenar dados dos Tributos que foram **alterados** e os **não alterados** e vincular a um Produto Log Consulta Tributária.                                                  | Código do Produto, Código da Filial, Todos os Campos de Tributos do Produto que foram atualizados, Todos os Campos de Tributos não atualizados, Data, Hora e Usuário. |   **Todos**    |
| Produto Log Envio Revisão Tributária | Histórico de Produtos enviados para Revisão Tributária para o Integrador | Armazenar os Produtos que foram enviados para Revisão Tributária, e quando houver retorno de atualização, sinalizar o Status como Revisado e gravar a Data e Hora do revisão. | Código Filial, Código do Produto, Data, Hora, Usuário de Envio, Status da Revisão, Integrador Fiscal                                                                  |   **Todos**    |
| Cenário Fiscal                       | Histórico de Alterações de Cenário Fiscal                                | Armazenar dados da atualização do Cenário Fiscal, quando o integrador for igual a **Mix Fiscal**                                                                              | ID do Cenário Fiscal, Data, Hora, Usuário e Histórico (descritivo da alteração realizada)                                                                             | **Mix Fiscal** |
